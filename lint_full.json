[{"filePath":"C:\\Users\\roman\\Projects\\smart-budget\\src\\App.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\roman\\Projects\\smart-budget\\src\\__mocks__\\firebase.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\roman\\Projects\\smart-budget\\src\\__tests__\\setup.test.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\roman\\Projects\\smart-budget\\src\\__tests__\\unit\\hooks\\useAuth.test.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":112,"column":14,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":112,"endColumn":17,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3596,3599],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3596,3599],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":113,"column":65,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":113,"endColumn":68,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3667,3670],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3667,3670],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":114,"column":58,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":114,"endColumn":61,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3731,3734],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3731,3734],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { renderHook, act, waitFor } from '@testing-library/react';\r\nimport {\r\n    onAuthStateChanged,\r\n    createUserWithEmailAndPassword,\r\n    updateProfile,\r\n    sendEmailVerification,\r\n    signOut,\r\n} from 'firebase/auth';\r\nimport { onSnapshot, setDoc } from 'firebase/firestore';\r\nimport { describe, it, expect, vi, beforeEach } from 'vitest';\r\n\r\nimport { useAuth } from '../../../hooks/useAuth';\r\n\r\nvi.mock('../../../firebase', () => ({\r\n    auth: { currentUser: null },\r\n    db: {},\r\n    appId: 'test-app-id',\r\n}));\r\n\r\nconst { mockDocRef } = vi.hoisted(() => ({\r\n    mockDocRef: { id: 'mock-doc-id' },\r\n}));\r\n\r\nvi.mock('firebase/firestore', () => ({\r\n    doc: vi.fn(() => mockDocRef),\r\n    setDoc: vi.fn(),\r\n    onSnapshot: vi.fn(),\r\n    DocumentReference: class {},\r\n}));\r\n\r\nvi.mock('firebase/auth', () => ({\r\n    getAuth: vi.fn(),\r\n    onAuthStateChanged: vi.fn(),\r\n    signInWithEmailAndPassword: vi.fn(),\r\n    createUserWithEmailAndPassword: vi.fn(),\r\n    signOut: vi.fn(),\r\n    sendPasswordResetEmail: vi.fn(),\r\n    updateProfile: vi.fn(),\r\n    GoogleAuthProvider: class {\r\n        setCustomParameters() {}\r\n    },\r\n    signInWithPopup: vi.fn(),\r\n    sendEmailVerification: vi.fn(),\r\n}));\r\n\r\ndescribe('useAuth', () => {\r\n    beforeEach(() => {\r\n        vi.clearAllMocks();\r\n    });\r\n\r\n    it('should initialize with loading state and subscribe to auth', () => {\r\n        vi.mocked(onAuthStateChanged).mockImplementation(() => vi.fn() as unknown as () => void);\r\n\r\n        const { result } = renderHook(() => useAuth());\r\n\r\n        expect(result.current.loading).toBe(true);\r\n        expect(onAuthStateChanged).toHaveBeenCalled();\r\n    });\r\n\r\n    it('should update user and profile on auth state change', async () => {\r\n        let authCallback: (user: unknown) => void = () => {};\r\n        vi.mocked(onAuthStateChanged).mockImplementation((_auth: unknown, cb: unknown) => {\r\n            authCallback = cb as (user: unknown) => void;\r\n            return vi.fn() as unknown as () => void;\r\n        });\r\n\r\n        let profileCallback: (snap: unknown) => void = () => {};\r\n        vi.mocked(onSnapshot).mockImplementation((_ref: unknown, cb: unknown) => {\r\n            profileCallback = cb as (snap: unknown) => void;\r\n            return vi.fn() as unknown as () => void;\r\n        });\r\n\r\n        const { result } = renderHook(() => useAuth());\r\n\r\n        const mockUser = { uid: 'user-1', email: 'test@test.com' };\r\n\r\n        act(() => {\r\n            authCallback(mockUser);\r\n        });\r\n\r\n        expect(result.current.user).toEqual(mockUser);\r\n        expect(onSnapshot).toHaveBeenCalled();\r\n\r\n        // Simulate profile load\r\n        const mockProfileSnap = {\r\n            exists: () => true,\r\n            data: () => ({\r\n                activeBudgetId: 'budget-1',\r\n                isPendingApproval: false,\r\n            }),\r\n        };\r\n\r\n        act(() => {\r\n            profileCallback(mockProfileSnap);\r\n        });\r\n\r\n        await waitFor(() => {\r\n            expect(result.current.activeBudgetId).toBe('budget-1');\r\n            expect(result.current.loading).toBe(false);\r\n        });\r\n    });\r\n\r\n    it('should handle registration flow', async () => {\r\n        // Setup initial auth subscription to just do nothing so hook renders\r\n        vi.mocked(onAuthStateChanged).mockImplementation(() => vi.fn() as unknown as () => void);\r\n\r\n        const { result } = renderHook(() => useAuth());\r\n\r\n        const mockUser = { uid: 'new-user', email: 'new@test.com' };\r\n        vi.mocked(createUserWithEmailAndPassword).mockResolvedValue({\r\n            user: mockUser,\r\n        } as any);\r\n        vi.mocked(updateProfile).mockResolvedValue(undefined as any);\r\n        vi.mocked(setDoc).mockResolvedValue(undefined as any); // Profile creation\r\n\r\n        await act(async () => {\r\n            await result.current.register('new@test.com', 'password', 'New User');\r\n        });\r\n\r\n        expect(createUserWithEmailAndPassword).toHaveBeenCalledWith(\r\n            expect.anything(),\r\n            'new@test.com',\r\n            'password'\r\n        );\r\n        expect(updateProfile).toHaveBeenCalledWith(mockUser, {\r\n            displayName: 'New User',\r\n        });\r\n        expect(setDoc).toHaveBeenCalled(); // Profile creation\r\n        expect(sendEmailVerification).toHaveBeenCalledWith(mockUser);\r\n    });\r\n\r\n    it('should handle logout', async () => {\r\n        vi.mocked(onAuthStateChanged).mockImplementation(() => vi.fn() as unknown as () => void);\r\n        const { result } = renderHook(() => useAuth());\r\n\r\n        await act(async () => {\r\n            await result.current.logout();\r\n        });\r\n\r\n        expect(signOut).toHaveBeenCalled();\r\n    });\r\n});\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\roman\\Projects\\smart-budget\\src\\__tests__\\unit\\hooks\\useBudgetData.test.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\roman\\Projects\\smart-budget\\src\\__tests__\\unit\\services\\assets.test.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\roman\\Projects\\smart-budget\\src\\__tests__\\unit\\services\\budget.test.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\roman\\Projects\\smart-budget\\src\\__tests__\\unit\\services\\loans.test.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\roman\\Projects\\smart-budget\\src\\__tests__\\unit\\services\\transactions.test.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":62,"column":31,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":62,"endColumn":34,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2013,2016],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2013,2016],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":196,"column":25,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":196,"endColumn":28,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7460,7463],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7460,7463],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { doc, writeBatch, runTransaction, getDocs } from 'firebase/firestore';\r\nimport { describe, it, expect, vi, beforeEach } from 'vitest';\r\n\r\nimport { transactionsService, TransactionData } from '../../../services/transactions.service';\r\nimport { fetchExchangeRate } from '../../../utils/currency';\r\n\r\n// --- MOCKS ---\r\n\r\nvi.mock('../../../firebase', () => ({\r\n    db: {},\r\n    appId: 'test-app-id',\r\n}));\r\n\r\nconst { mockBatch, mockTransactionHandler, mockDocRef, mockCollectionRef } = vi.hoisted(() => {\r\n    return {\r\n        mockBatch: {\r\n            set: vi.fn(),\r\n            update: vi.fn(),\r\n            delete: vi.fn(),\r\n            commit: vi.fn().mockResolvedValue(undefined),\r\n        },\r\n        mockTransactionHandler: {\r\n            get: vi.fn(),\r\n            update: vi.fn(),\r\n            set: vi.fn(),\r\n            delete: vi.fn(),\r\n        },\r\n        mockDocRef: { id: 'mock-doc-id', path: 'mock/path' },\r\n        mockCollectionRef: { id: 'mock-col-id', path: 'mock/path' },\r\n    };\r\n});\r\n\r\nvi.mock('firebase/firestore', () => ({\r\n    collection: vi.fn(() => mockCollectionRef),\r\n    doc: vi.fn(() => mockDocRef),\r\n    writeBatch: vi.fn(() => mockBatch),\r\n    serverTimestamp: vi.fn(() => 'mock-timestamp'),\r\n    increment: vi.fn((n) => ({ type: 'increment', value: n })),\r\n    runTransaction: vi.fn((_db, callback) => callback(mockTransactionHandler)),\r\n    query: vi.fn(),\r\n    where: vi.fn(),\r\n    getDocs: vi.fn(),\r\n    updateDoc: vi.fn(),\r\n    DocumentReference: class {},\r\n    CollectionReference: class {},\r\n}));\r\n\r\nvi.mock('../../../utils/currency', () => ({\r\n    fetchExchangeRate: vi.fn(),\r\n}));\r\n\r\ndescribe('TransactionsService', () => {\r\n    const budgetId = 'budget-123';\r\n    const userId = 'user-abc';\r\n    const user = { uid: userId, displayName: 'Test User', email: 'test@example.com' };\r\n    const mainCurrency = 'USD';\r\n    // Storage currency is EUR\r\n\r\n    beforeEach(() => {\r\n        vi.clearAllMocks();\r\n        // Default exchange rates\r\n        (fetchExchangeRate as any).mockImplementation((from: string, to: string) => {\r\n            if (from === to) return Promise.resolve(1);\r\n            if (from === 'USD' && to === 'EUR') return Promise.resolve(0.9);\r\n            if (from === 'EUR' && to === 'USD') return Promise.resolve(1.1);\r\n            return Promise.resolve(1);\r\n        });\r\n    });\r\n\r\n    describe('addTransaction', () => {\r\n        const txData: TransactionData = {\r\n            amount: 100,\r\n            categoryId: 'cat-1',\r\n            date: new Date(),\r\n            description: 'Test tx',\r\n            type: 'expense',\r\n            currency: 'USD',\r\n            originalCurrency: 'USD',\r\n            originalAmount: 100,\r\n            isTransfer: false,\r\n        };\r\n\r\n        it('should add an expense transaction and update budget balance (decrement)', async () => {\r\n            await transactionsService.addTransaction(budgetId, user, txData, mainCurrency);\r\n\r\n            expect(doc).toHaveBeenCalled(); // Should assume correct args\r\n            expect(writeBatch).toHaveBeenCalled();\r\n            expect(mockBatch.set).toHaveBeenCalled(); // Transaction doc\r\n            expect(mockBatch.update).toHaveBeenCalled(); // Budget update\r\n\r\n            // Verify budget update calls increment with negative value for expense\r\n            // We can't easily inspect the exact args of increment here because it returns an object,\r\n            // but we can check if update was called with specific structure if we knew implementation details.\r\n            // For now, simple verification that batch flow executed is good start.\r\n            expect(mockBatch.commit).toHaveBeenCalled();\r\n        });\r\n\r\n        it('should add an income transaction and update budget balance (increment)', async () => {\r\n            const incomeTx = { ...txData, type: 'income' as const };\r\n            await transactionsService.addTransaction(budgetId, user, incomeTx, mainCurrency);\r\n\r\n            expect(mockBatch.set).toHaveBeenCalled();\r\n            expect(mockBatch.update).toHaveBeenCalled();\r\n            expect(mockBatch.commit).toHaveBeenCalled();\r\n        });\r\n\r\n        it('should handle currency conversion', async () => {\r\n            // Adding USD transaction, storage is EUR.\r\n            // 100 USD * 0.9 = 90 EUR.\r\n            await transactionsService.addTransaction(budgetId, user, txData, mainCurrency);\r\n\r\n            expect(fetchExchangeRate).toHaveBeenCalledWith('USD', 'EUR');\r\n        });\r\n    });\r\n\r\n    describe('updateTransaction', () => {\r\n        const oldTxId = 'tx-old';\r\n        const newData: TransactionData = {\r\n            amount: 200, // Changed from let's say 100\r\n            categoryId: 'cat-1',\r\n            date: new Date(),\r\n            description: 'Updated tx',\r\n            type: 'expense',\r\n            currency: 'USD',\r\n            originalCurrency: 'USD',\r\n            originalAmount: 200,\r\n            isTransfer: false,\r\n        };\r\n\r\n        it('should update transaction and balance diff', async () => {\r\n            // Mock fetching old transaction\r\n            mockTransactionHandler.get.mockResolvedValue({\r\n                exists: () => true,\r\n                data: () => ({\r\n                    amount: 90, // stored as EUR (100 USD)\r\n                    currency: 'USD',\r\n                    type: 'expense',\r\n                    // ... other fields\r\n                }),\r\n            });\r\n\r\n            await transactionsService.updateTransaction(budgetId, oldTxId, newData, mainCurrency);\r\n\r\n            expect(runTransaction).toHaveBeenCalled();\r\n            expect(mockTransactionHandler.get).toHaveBeenCalled();\r\n            expect(mockTransactionHandler.update).toHaveBeenCalledTimes(2); // Tx update + Budget update\r\n        });\r\n\r\n        it('should throw if transaction does not exist', async () => {\r\n            mockTransactionHandler.get.mockResolvedValue({\r\n                exists: () => false,\r\n            });\r\n\r\n            await expect(\r\n                transactionsService.updateTransaction(budgetId, oldTxId, newData, mainCurrency)\r\n            ).rejects.toThrow('Transaction does not exist!');\r\n        });\r\n    });\r\n\r\n    describe('deleteTransaction', () => {\r\n        const txId = 'tx-del';\r\n\r\n        it('should delete transaction and revert balance', async () => {\r\n            mockTransactionHandler.get.mockResolvedValue({\r\n                exists: () => true,\r\n                data: () => ({\r\n                    amount: '90',\r\n                    type: 'expense',\r\n                }),\r\n            });\r\n\r\n            await transactionsService.deleteTransaction(budgetId, txId);\r\n\r\n            expect(runTransaction).toHaveBeenCalled();\r\n            expect(mockTransactionHandler.delete).toHaveBeenCalled();\r\n        });\r\n    });\r\n\r\n    describe('importTransactions', () => {\r\n        it('should import transactions and skip duplicates', async () => {\r\n            const importData: TransactionData[] = [\r\n                {\r\n                    amount: 50,\r\n                    categoryId: 'cat-1',\r\n                    date: new Date(),\r\n                    description: 'Imported tx',\r\n                    type: 'expense',\r\n                    currency: 'USD',\r\n                    originalCurrency: 'USD',\r\n                    originalAmount: 50,\r\n                    importId: 'import-1',\r\n                },\r\n            ];\r\n\r\n            // Mock getDocs to return empty snapshot (no duplicates)\r\n            (getDocs as any).mockResolvedValue({\r\n                forEach: vi.fn(),\r\n            });\r\n\r\n            const result = await transactionsService.importTransactions(\r\n                budgetId,\r\n                user,\r\n                importData,\r\n                mainCurrency\r\n            );\r\n\r\n            expect(getDocs).toHaveBeenCalled();\r\n            expect(mockBatch.commit).toHaveBeenCalled();\r\n            expect(result.imported).toBe(1);\r\n        });\r\n    });\r\n});\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\roman\\Projects\\smart-budget\\src\\__tests__\\unit\\utils\\currency.test.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\roman\\Projects\\smart-budget\\src\\components\\AppShell.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\roman\\Projects\\smart-budget\\src\\components\\AuthScreen.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\roman\\Projects\\smart-budget\\src\\components\\BudgetProgress.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\roman\\Projects\\smart-budget\\src\\components\\CategoryItem.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\roman\\Projects\\smart-budget\\src\\components\\Charts.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\roman\\Projects\\smart-budget\\src\\components\\ErrorBoundary.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\roman\\Projects\\smart-budget\\src\\components\\Layout.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\roman\\Projects\\smart-budget\\src\\components\\NetWorthChart.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\roman\\Projects\\smart-budget\\src\\components\\TransactionForm.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\roman\\Projects\\smart-budget\\src\\components\\auth\\AuthForm.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\roman\\Projects\\smart-budget\\src\\components\\auth\\SocialLogin.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\roman\\Projects\\smart-budget\\src\\components\\forms\\transaction\\AmountInput.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\roman\\Projects\\smart-budget\\src\\components\\forms\\transaction\\CategoryGrid.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\roman\\Projects\\smart-budget\\src\\components\\forms\\transaction\\TypeSwitcher.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\roman\\Projects\\smart-budget\\src\\components\\integrations\\MonobankConnect.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\roman\\Projects\\smart-budget\\src\\components\\modals\\AssetModal.jsx","messages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'valuePerUnit'. Either include it or remove the dependency array.","line":95,"column":8,"nodeType":"ArrayExpression","endLine":95,"endColumn":68,"suggestions":[{"desc":"Update the dependencies array to be: [selectedCurrency, mainCurrency, type, isOpen, editingAsset, valuePerUnit]","fix":{"range":[3480,3540],"text":"[selectedCurrency, mainCurrency, type, isOpen, editingAsset, valuePerUnit]"}}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { X, RefreshCcw, Loader2, DollarSign, Bitcoin, Zap, ArrowRightLeft } from 'lucide-react';\r\nimport React, { useState, useEffect } from 'react';\r\n\r\nimport { CURRENCIES } from '../../constants';\r\nimport { fetchExchangeRate } from '../../utils/currency';\r\n\r\nconst CRYPTO_OPTIONS = [\r\n    { id: 'tether', name: 'Tether (USDT)', icon: DollarSign },\r\n    { id: 'bitcoin', name: 'Bitcoin (BTC)', icon: Bitcoin },\r\n    { id: 'ethereum', name: 'Ethereum (ETH)', icon: Zap },\r\n];\r\n\r\nexport default function AssetModal({\r\n    isOpen,\r\n    onClose,\r\n    onSave,\r\n    editingAsset,\r\n    t,\r\n    currency: mainCurrency,\r\n}) {\r\n    const [name, setName] = useState('');\r\n    const [type, setType] = useState('cash');\r\n    const [amount, setAmount] = useState('');\r\n    const [valuePerUnit, setValuePerUnit] = useState('');\r\n\r\n    const [selectedCrypto, setSelectedCrypto] = useState('tether');\r\n    const [selectedCurrency, setSelectedCurrency] = useState(mainCurrency || 'EUR');\r\n    const [isFetchingRate, setIsFetchingRate] = useState(false);\r\n\r\n    // Populate form when editing or resetting when adding\r\n    useEffect(() => {\r\n        if (isOpen) {\r\n            if (editingAsset) {\r\n                setName(editingAsset.name || '');\r\n                setType(editingAsset.type || 'cash');\r\n                setAmount(editingAsset.amount?.toString() || '');\r\n                // Handle legacy 'value' field or new 'valuePerUnit'\r\n                setValuePerUnit((editingAsset.valuePerUnit || editingAsset.value || 1).toString());\r\n\r\n                if (editingAsset.type === 'crypto') {\r\n                    setSelectedCrypto(editingAsset.cryptoId || 'tether');\r\n                } else {\r\n                    setSelectedCurrency(editingAsset.originalCurrency || mainCurrency);\r\n                }\r\n            } else {\r\n                setName('');\r\n                setType('cash');\r\n                setAmount('');\r\n                setValuePerUnit('1');\r\n                setSelectedCrypto('tether');\r\n                setSelectedCurrency(mainCurrency || 'EUR');\r\n            }\r\n        }\r\n    }, [editingAsset, isOpen, mainCurrency]);\r\n\r\n    // Auto-fetch fiat rate only for new assets or when currency changes\r\n    useEffect(() => {\r\n        let isMounted = true;\r\n        const fetchFiatRate = async () => {\r\n            if (type === 'crypto' || !isOpen) return;\r\n\r\n            // Rate is 1 if currencies match\r\n            if (selectedCurrency === mainCurrency) {\r\n                if (isMounted) setValuePerUnit('1');\r\n                return;\r\n            }\r\n\r\n            // Don't auto-fetch if we're just loading an existing asset (keep saved rate)\r\n            if (\r\n                editingAsset &&\r\n                editingAsset.originalCurrency === selectedCurrency &&\r\n                valuePerUnit !== ''\r\n            ) {\r\n                return;\r\n            }\r\n\r\n            setIsFetchingRate(true);\r\n            try {\r\n                const rate = await fetchExchangeRate(selectedCurrency, mainCurrency);\r\n                if (isMounted && rate) {\r\n                    setValuePerUnit(rate.toString());\r\n                }\r\n            } catch (e) {\r\n                console.error('Fiat rate error', e);\r\n            } finally {\r\n                if (isMounted) setIsFetchingRate(false);\r\n            }\r\n        };\r\n\r\n        const timer = setTimeout(fetchFiatRate, 500);\r\n        return () => {\r\n            isMounted = false;\r\n            clearTimeout(timer);\r\n        };\r\n    }, [selectedCurrency, mainCurrency, type, isOpen, editingAsset]);\r\n\r\n    const handleCryptoFetch = async () => {\r\n        setIsFetchingRate(true);\r\n        try {\r\n            const rate = await fetchExchangeRate(selectedCrypto, mainCurrency, true);\r\n            if (rate) setValuePerUnit(rate.toString());\r\n        } catch (e) {\r\n            console.error('Crypto fetch error', e);\r\n        } finally {\r\n            setIsFetchingRate(false);\r\n        }\r\n    };\r\n\r\n    if (!isOpen) return null;\r\n\r\n    const handleSubmit = (e) => {\r\n        e.preventDefault();\r\n\r\n        // QA Check: Ensure we send Numbers to Firestore, not Strings\r\n        const finalAmount = parseFloat(amount) || 0;\r\n        const finalRate = parseFloat(valuePerUnit) || 1;\r\n\r\n        onSave({\r\n            name:\r\n                type === 'crypto'\r\n                    ? CRYPTO_OPTIONS.find((c) => c.id === selectedCrypto)?.name\r\n                    : name,\r\n            type,\r\n            amount: finalAmount,\r\n            valuePerUnit: finalRate,\r\n            cryptoId: type === 'crypto' ? selectedCrypto : null,\r\n            originalCurrency: type === 'crypto' ? null : selectedCurrency,\r\n        });\r\n\r\n        onClose();\r\n    };\r\n\r\n    const totalPreview = (parseFloat(amount || 0) * parseFloat(valuePerUnit || 1)).toFixed(2);\r\n\r\n    return (\r\n        <div className=\"fixed inset-0 bg-black/60 backdrop-blur-sm flex items-center justify-center z-[60] p-4 animate-in fade-in duration-200\">\r\n            <div className=\"bg-white dark:bg-slate-900 w-full max-w-sm rounded-2xl p-6 shadow-xl border border-slate-200 dark:border-slate-700\">\r\n                <div className=\"flex justify-between items-center mb-4\">\r\n                    <h3 className=\"font-bold text-lg text-slate-900 dark:text-white\">\r\n                        {editingAsset ? t.edit_asset : t.add_asset}\r\n                    </h3>\r\n                    <button onClick={onClose}>\r\n                        <X size={20} className=\"text-slate-400\" />\r\n                    </button>\r\n                </div>\r\n\r\n                <form onSubmit={handleSubmit} className=\"space-y-4\">\r\n                    <div className=\"flex gap-2 bg-slate-100 dark:bg-slate-800 p-1 rounded-xl\">\r\n                        {['cash', 'crypto', 'stock'].map((assetType) => (\r\n                            <button\r\n                                key={assetType}\r\n                                type=\"button\"\r\n                                onClick={() => setType(assetType)}\r\n                                className={`flex-1 py-2 rounded-lg text-xs font-bold transition-all ${type === assetType ? 'bg-white shadow text-slate-900' : 'text-slate-500'}`}\r\n                            >\r\n                                {t[`asset_type_${assetType}`]}\r\n                            </button>\r\n                        ))}\r\n                    </div>\r\n\r\n                    {type === 'crypto' ? (\r\n                        <>\r\n                            <div className=\"space-y-2\">\r\n                                <label className=\"text-xs text-slate-500 font-bold\">\r\n                                    {t.select_coin}\r\n                                </label>\r\n                                <div className=\"grid grid-cols-3 gap-2\">\r\n                                    {CRYPTO_OPTIONS.map((c) => (\r\n                                        <button\r\n                                            key={c.id}\r\n                                            type=\"button\"\r\n                                            onClick={() => {\r\n                                                setSelectedCrypto(c.id);\r\n                                                setValuePerUnit('');\r\n                                            }}\r\n                                            className={`p-2 rounded-lg text-xs font-bold flex flex-col items-center gap-1 border transition-all ${selectedCrypto === c.id ? 'border-blue-500 bg-blue-50 text-blue-600' : 'border-slate-200 bg-white text-slate-500'}`}\r\n                                        >\r\n                                            {React.createElement(c.icon, { size: 16 })}\r\n                                            {c.name.split(' ')[0]}\r\n                                        </button>\r\n                                    ))}\r\n                                </div>\r\n                            </div>\r\n                            <div className=\"grid grid-cols-2 gap-3\">\r\n                                <div className=\"flex flex-col\">\r\n                                    <label className=\"text-xs text-slate-500 font-bold mb-1 block\">\r\n                                        {t.holdings}\r\n                                    </label>\r\n                                    <input\r\n                                        type=\"number\"\r\n                                        value={amount}\r\n                                        onChange={(e) => setAmount(e.target.value)}\r\n                                        className=\"w-full p-3 rounded-xl bg-slate-50 dark:bg-slate-800 border-none outline-none font-bold mt-auto\"\r\n                                        required\r\n                                        step=\"any\"\r\n                                        placeholder=\"0.00\"\r\n                                    />\r\n                                </div>\r\n                                <div className=\"flex flex-col\">\r\n                                    <label className=\"text-xs text-slate-500 font-bold mb-1 block\">\r\n                                        {t.current_rate} ({mainCurrency})\r\n                                    </label>\r\n                                    <div className=\"relative mt-auto\">\r\n                                        <input\r\n                                            type=\"number\"\r\n                                            value={valuePerUnit}\r\n                                            onChange={(e) => setValuePerUnit(e.target.value)}\r\n                                            className=\"w-full p-3 pr-10 rounded-xl bg-slate-50 dark:bg-slate-800 border-none outline-none font-bold\"\r\n                                            required\r\n                                            step=\"any\"\r\n                                            placeholder=\"0.00\"\r\n                                        />\r\n                                        <button\r\n                                            type=\"button\"\r\n                                            onClick={handleCryptoFetch}\r\n                                            className=\"absolute right-2 top-1/2 -translate-y-1/2 text-blue-500 hover:bg-blue-50 p-1 rounded-full transition-colors\"\r\n                                            disabled={isFetchingRate}\r\n                                        >\r\n                                            {isFetchingRate ? (\r\n                                                <Loader2 size={16} className=\"animate-spin\" />\r\n                                            ) : (\r\n                                                <RefreshCcw size={16} />\r\n                                            )}\r\n                                        </button>\r\n                                    </div>\r\n                                </div>\r\n                            </div>\r\n                        </>\r\n                    ) : (\r\n                        <>\r\n                            <div>\r\n                                <label className=\"text-xs text-slate-500 font-bold mb-1 block\">\r\n                                    {t.asset_name}\r\n                                </label>\r\n                                <input\r\n                                    type=\"text\"\r\n                                    value={name}\r\n                                    onChange={(e) => setName(e.target.value)}\r\n                                    placeholder={type === 'stock' ? 'e.g. Apple Inc.' : 'e.g. Cash'}\r\n                                    className=\"w-full p-3 rounded-xl bg-slate-50 dark:bg-slate-800 border-none outline-none font-medium\"\r\n                                    required\r\n                                />\r\n                            </div>\r\n\r\n                            <div className=\"grid grid-cols-2 gap-3\">\r\n                                <div className=\"flex flex-col\">\r\n                                    <label className=\"text-xs text-slate-500 font-bold mb-1 block\">\r\n                                        {t.holdings}\r\n                                    </label>\r\n                                    <input\r\n                                        type=\"number\"\r\n                                        value={amount}\r\n                                        onChange={(e) => setAmount(e.target.value)}\r\n                                        className=\"w-full p-3 rounded-xl bg-slate-50 dark:bg-slate-800 border-none outline-none text-lg font-bold mt-auto\"\r\n                                        required\r\n                                        step=\"any\"\r\n                                        placeholder=\"0\"\r\n                                    />\r\n                                </div>\r\n\r\n                                <div className=\"flex flex-col\">\r\n                                    <label className=\"text-xs text-slate-500 font-bold mb-1 block\">\r\n                                        {t.asset_currency}\r\n                                    </label>\r\n                                    <select\r\n                                        value={selectedCurrency}\r\n                                        onChange={(e) => setSelectedCurrency(e.target.value)}\r\n                                        className=\"w-full p-3 rounded-xl bg-slate-50 dark:bg-slate-800 border-none outline-none font-bold text-slate-700 dark:text-slate-200 cursor-pointer mt-auto\"\r\n                                    >\r\n                                        {Object.keys(CURRENCIES).map((code) => (\r\n                                            <option key={code} value={code}>\r\n                                                {code} ({CURRENCIES[code].symbol})\r\n                                            </option>\r\n                                        ))}\r\n                                    </select>\r\n                                </div>\r\n                            </div>\r\n\r\n                            {selectedCurrency !== mainCurrency && (\r\n                                <div className=\"bg-blue-50 dark:bg-blue-900/20 p-3 rounded-xl border border-blue-100 dark:border-blue-800 flex flex-col gap-2 animate-in fade-in\">\r\n                                    <div className=\"flex justify-between items-center text-xs\">\r\n                                        <span className=\"font-bold text-blue-600 dark:text-blue-400 flex items-center gap-1\">\r\n                                            <ArrowRightLeft size={12} /> {t.exchange_rate}\r\n                                        </span>\r\n                                        {isFetchingRate && (\r\n                                            <span className=\"text-blue-400 animate-pulse\">\r\n                                                {t.auto_rate_fetching}\r\n                                            </span>\r\n                                        )}\r\n                                    </div>\r\n                                    <div className=\"flex gap-2 items-center\">\r\n                                        <span className=\"text-xs text-slate-400\">\r\n                                            1 {selectedCurrency} =\r\n                                        </span>\r\n                                        <input\r\n                                            type=\"number\"\r\n                                            value={valuePerUnit}\r\n                                            onChange={(e) => setValuePerUnit(e.target.value)}\r\n                                            className=\"flex-1 bg-white dark:bg-slate-800 border border-slate-200 dark:border-slate-700 rounded-lg px-2 py-1 text-sm font-bold outline-none text-right\"\r\n                                            placeholder=\"Rate\"\r\n                                            step=\"any\"\r\n                                        />\r\n                                        <span className=\"text-xs font-bold text-slate-500\">\r\n                                            {mainCurrency}\r\n                                        </span>\r\n                                    </div>\r\n                                </div>\r\n                            )}\r\n                        </>\r\n                    )}\r\n\r\n                    <div className=\"flex justify-between items-center pt-2 border-t border-slate-100 dark:border-slate-800\">\r\n                        <span className=\"text-xs text-slate-400 font-bold uppercase\">\r\n                            {t.total_value}\r\n                        </span>\r\n                        <span className=\"text-xl font-bold text-slate-900 dark:text-white\">\r\n                            {CURRENCIES[mainCurrency]?.symbol}\r\n                            {totalPreview}\r\n                        </span>\r\n                    </div>\r\n\r\n                    <button\r\n                        type=\"submit\"\r\n                        disabled={!amount || isFetchingRate}\r\n                        className=\"w-full bg-slate-900 dark:bg-white text-white dark:text-slate-900 py-3 rounded-xl font-bold hover:opacity-90 disabled:opacity-50 transition-all\"\r\n                    >\r\n                        {t.save_btn}\r\n                    </button>\r\n                </form>\r\n            </div>\r\n        </div>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\roman\\Projects\\smart-budget\\src\\components\\modals\\CategoryModal.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\roman\\Projects\\smart-budget\\src\\components\\modals\\ConfirmModal.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\roman\\Projects\\smart-budget\\src\\components\\modals\\ImportModal.jsx","messages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"The 'labels' object makes the dependencies of useCallback Hook (at line 131) change on every render. To fix this, wrap the initialization of 'labels' in its own useMemo() Hook.","line":33,"column":11,"nodeType":"VariableDeclarator","endLine":57,"endColumn":6},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useCallback has a missing dependency: 'transactions'. Either include it or remove the dependency array. You can also replace multiple useState variables with useReducer if 'setSelectedIds' needs the current value of 'transactions'.","line":187,"column":8,"nodeType":"ArrayExpression","endLine":187,"endColumn":47,"suggestions":[{"desc":"Update the dependencies array to be: [selectedIds.size, transactions]","fix":{"range":[6743,6782],"text":"[selectedIds.size, transactions]"}}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { X, Upload, FileText, CheckCircle, AlertCircle, Loader2, Sparkles } from 'lucide-react';\r\nimport React, { useState, useCallback, useRef } from 'react';\r\n\r\nimport { categorizeWithAI } from '../../services/geminiCategorizer.service';\r\nimport { parseRevolutCSV, validateFile } from '../../utils/revolutParser';\r\n\r\n/**\r\n * ImportModal - 3-step wizard for importing Revolut CSV transactions\r\n * Step 1: File upload (drag & drop)\r\n * Step 2: Preview & select transactions\r\n * Step 3: Import result\r\n */\r\nexport default function ImportModal({\r\n    isOpen,\r\n    onClose,\r\n    onImport,\r\n    categoryRules = [],\r\n    categories = [],\r\n    t = {},\r\n}) {\r\n    const [step, setStep] = useState(1);\r\n    const [isDragging, setIsDragging] = useState(false);\r\n    const [error, setError] = useState(null);\r\n    const [transactions, setTransactions] = useState([]);\r\n    const [selectedIds, setSelectedIds] = useState(new Set());\r\n    const [isImporting, setIsImporting] = useState(false);\r\n    const [isCategorizingAI, setIsCategorizingAI] = useState(false);\r\n    const [importResult, setImportResult] = useState(null);\r\n\r\n    const fileInputRef = useRef(null);\r\n\r\n    // Translations with fallbacks\r\n    const labels = {\r\n        title: t.import_title || 'Import Transactions',\r\n        dropHint: t.import_drop_hint || 'Drag & drop CSV file here or click to select',\r\n        invalidFormat: t.import_invalid_format || 'Invalid file format. Please select a .csv file',\r\n        unknownStructure:\r\n            t.import_unknown_structure || 'Unknown file structure. Expected Revolut CSV format',\r\n        parseError: t.import_parse_error || 'Error parsing file',\r\n        fileTooLarge: t.import_file_too_large || 'File is too large (max 5MB)',\r\n        previewTitle: t.import_preview_title || 'Preview',\r\n        foundTransactions: t.import_found_transactions || 'transactions found',\r\n        back: t.import_back || 'Back',\r\n        confirm: t.import_confirm || 'Import',\r\n        success: t.import_success || 'Successfully imported',\r\n        skipped: t.import_skipped_duplicates || 'duplicates skipped',\r\n        close: t.btn_cancel || 'Close',\r\n        selectAll: t.import_select_all || 'Select All',\r\n        date: t.date || 'Date',\r\n        description: t.description || 'Description',\r\n        amount: t.amount || 'Amount',\r\n        type: t.type || 'Type',\r\n        expense: t.expense || 'Expense',\r\n        income: t.income || 'Income',\r\n        aiLoading: t.ai_loading || 'AI is analyzing your expenses...',\r\n        aiLoadingHint: t.ai_loading_hint || 'This may take a few seconds',\r\n    };\r\n\r\n    const resetState = useCallback(() => {\r\n        setStep(1);\r\n        setError(null);\r\n        setTransactions([]);\r\n        setSelectedIds(new Set());\r\n        setIsImporting(false);\r\n        setImportResult(null);\r\n    }, []);\r\n\r\n    const handleClose = useCallback(() => {\r\n        resetState();\r\n        onClose();\r\n    }, [onClose, resetState]);\r\n\r\n    // File handling\r\n    const handleFile = useCallback(\r\n        async (file) => {\r\n            setError(null);\r\n\r\n            const validation = validateFile(file);\r\n            if (!validation.valid) {\r\n                const errorMessages = {\r\n                    INVALID_FORMAT: labels.invalidFormat,\r\n                    FILE_TOO_LARGE: labels.fileTooLarge,\r\n                    NO_FILE: labels.invalidFormat,\r\n                };\r\n                setError(errorMessages[validation.error] || labels.parseError);\r\n                return;\r\n            }\r\n\r\n            const result = await parseRevolutCSV(file, categoryRules);\r\n\r\n            if (!result.success) {\r\n                const errorMessages = {\r\n                    INVALID_FORMAT: labels.invalidFormat,\r\n                    UNKNOWN_STRUCTURE: labels.unknownStructure,\r\n                    PARSE_ERROR: labels.parseError,\r\n                };\r\n                setError(errorMessages[result.error] || labels.parseError);\r\n                return;\r\n            }\r\n\r\n            if (result.transactions.length === 0) {\r\n                setError(t.import_no_transactions || 'No valid transactions found in file');\r\n                return;\r\n            }\r\n\r\n            // Apply AI categorization for transactions that still have 'other' category\r\n            let categorizedTxs = result.transactions;\r\n            const uncategorizedTxs = categorizedTxs.filter((tx) => tx.category === 'other');\r\n\r\n            if (uncategorizedTxs.length > 0 && categories.length > 0) {\r\n                setIsCategorizingAI(true);\r\n                try {\r\n                    console.log(\r\n                        `[Import] Running AI categorization for ${uncategorizedTxs.length} transactions...`\r\n                    );\r\n                    categorizedTxs = await categorizeWithAI(categorizedTxs, categories);\r\n                } catch (err) {\r\n                    console.warn(\r\n                        '[Import] AI categorization failed, using keyword rules only:',\r\n                        err\r\n                    );\r\n                } finally {\r\n                    setIsCategorizingAI(false);\r\n                }\r\n            }\r\n\r\n            setTransactions(categorizedTxs);\r\n            setSelectedIds(new Set(categorizedTxs.map((_, i) => i)));\r\n            setStep(2);\r\n        },\r\n        [labels, t, categoryRules, categories]\r\n    );\r\n\r\n    // Drag & Drop handlers\r\n    const handleDragOver = useCallback((e) => {\r\n        e.preventDefault();\r\n        setIsDragging(true);\r\n    }, []);\r\n\r\n    const handleDragLeave = useCallback((e) => {\r\n        e.preventDefault();\r\n        setIsDragging(false);\r\n    }, []);\r\n\r\n    const handleDrop = useCallback(\r\n        (e) => {\r\n            e.preventDefault();\r\n            setIsDragging(false);\r\n\r\n            const file = e.dataTransfer.files?.[0];\r\n            if (file) {\r\n                handleFile(file);\r\n            }\r\n        },\r\n        [handleFile]\r\n    );\r\n\r\n    const handleFileInput = useCallback(\r\n        (e) => {\r\n            const file = e.target.files?.[0];\r\n            if (file) {\r\n                handleFile(file);\r\n            }\r\n        },\r\n        [handleFile]\r\n    );\r\n\r\n    // Selection handlers\r\n    const toggleSelection = useCallback((index) => {\r\n        setSelectedIds((prev) => {\r\n            const next = new Set(prev);\r\n            if (next.has(index)) {\r\n                next.delete(index);\r\n            } else {\r\n                next.add(index);\r\n            }\r\n            return next;\r\n        });\r\n    }, []);\r\n\r\n    const toggleAll = useCallback(() => {\r\n        if (selectedIds.size === transactions.length) {\r\n            setSelectedIds(new Set());\r\n        } else {\r\n            setSelectedIds(new Set(transactions.map((_, i) => i)));\r\n        }\r\n    }, [selectedIds.size, transactions.length]);\r\n\r\n    // Import handler\r\n    const handleImport = useCallback(async () => {\r\n        const selectedTransactions = transactions.filter((_, i) => selectedIds.has(i));\r\n\r\n        if (selectedTransactions.length === 0) return;\r\n\r\n        setIsImporting(true);\r\n\r\n        try {\r\n            const result = await onImport(selectedTransactions);\r\n            setImportResult(result);\r\n            setStep(3);\r\n        } catch (err) {\r\n            console.error('[ImportModal] Import error:', err);\r\n            setError(err.message || labels.parseError);\r\n        } finally {\r\n            setIsImporting(false);\r\n        }\r\n    }, [transactions, selectedIds, onImport, labels.parseError]);\r\n\r\n    if (!isOpen) return null;\r\n\r\n    return (\r\n        <div className=\"fixed inset-0 bg-black/60 backdrop-blur-sm flex items-center justify-center z-[60] p-4 animate-in fade-in duration-200\">\r\n            {/* AI Loading Overlay */}\r\n            {isCategorizingAI && (\r\n                <div className=\"absolute inset-0 bg-black/60 backdrop-blur-sm flex items-center justify-center z-[70] rounded-2xl\">\r\n                    <div className=\"bg-white dark:bg-slate-800 rounded-2xl p-8 text-center max-w-sm shadow-2xl animate-in zoom-in-95 duration-200\">\r\n                        <Sparkles className=\"w-16 h-16 text-purple-500 animate-pulse mx-auto mb-4\" />\r\n                        <h3 className=\"text-xl font-bold dark:text-white mb-2\">\r\n                             {labels.aiLoading}\r\n                        </h3>\r\n                        <p className=\"text-slate-500 dark:text-slate-400\">{labels.aiLoadingHint}</p>\r\n                    </div>\r\n                </div>\r\n            )}\r\n\r\n            <div className=\"bg-white dark:bg-slate-900 w-full max-w-2xl rounded-2xl shadow-xl border border-slate-200 dark:border-slate-700 max-h-[90vh] flex flex-col relative overflow-hidden\">\r\n                {/* Header */}\r\n                <div className=\"flex justify-between items-center p-6 border-b border-slate-200 dark:border-slate-700\">\r\n                    <h3 className=\"font-bold text-lg text-slate-900 dark:text-white\">\r\n                        {labels.title}\r\n                    </h3>\r\n                    <button\r\n                        onClick={handleClose}\r\n                        className=\"p-1 hover:bg-slate-100 dark:hover:bg-slate-800 rounded-lg transition-colors\"\r\n                    >\r\n                        <X size={20} className=\"text-slate-400\" />\r\n                    </button>\r\n                </div>\r\n\r\n                {/* Content */}\r\n                <div className=\"flex-1 overflow-auto p-6\">\r\n                    {/* Step 1: Upload */}\r\n                    {step === 1 && (\r\n                        <div className=\"space-y-4\">\r\n                            <div\r\n                                role=\"button\"\r\n                                tabIndex={0}\r\n                                onClick={() => fileInputRef.current?.click()}\r\n                                onKeyDown={(e) => {\r\n                                    if (e.key === 'Enter' || e.key === ' ') {\r\n                                        e.preventDefault();\r\n                                        fileInputRef.current?.click();\r\n                                    }\r\n                                }}\r\n                                onDragOver={handleDragOver}\r\n                                onDragLeave={handleDragLeave}\r\n                                onDrop={handleDrop}\r\n                                className={`\r\n                                    border-2 border-dashed rounded-xl p-12 text-center cursor-pointer\r\n                                    transition-all duration-200\r\n                                    ${\r\n                                        isDragging\r\n                                            ? 'border-blue-500 bg-blue-50 dark:bg-blue-900/20'\r\n                                            : 'border-slate-300 dark:border-slate-600 hover:border-blue-400 hover:bg-slate-50 dark:hover:bg-slate-800/50'\r\n                                    }\r\n                                `}\r\n                            >\r\n                                <Upload\r\n                                    size={48}\r\n                                    className={`mx-auto mb-4 ${isDragging ? 'text-blue-500' : 'text-slate-400'}`}\r\n                                />\r\n                                <p className=\"text-slate-600 dark:text-slate-300 font-medium\">\r\n                                    {labels.dropHint}\r\n                                </p>\r\n                                <p className=\"text-sm text-slate-400 mt-2\">Revolut CSV</p>\r\n                            </div>\r\n\r\n                            <input\r\n                                ref={fileInputRef}\r\n                                type=\"file\"\r\n                                accept=\".csv\"\r\n                                onChange={handleFileInput}\r\n                                className=\"hidden\"\r\n                            />\r\n\r\n                            {error && (\r\n                                <div className=\"flex items-center gap-3 p-4 bg-red-50 dark:bg-red-900/20 rounded-xl text-red-600 dark:text-red-400\">\r\n                                    <AlertCircle size={20} />\r\n                                    <span>{error}</span>\r\n                                </div>\r\n                            )}\r\n                        </div>\r\n                    )}\r\n\r\n                    {/* Step 2: Preview */}\r\n                    {step === 2 && (\r\n                        <div className=\"space-y-4\">\r\n                            <div className=\"flex items-center justify-between\">\r\n                                <div className=\"flex items-center gap-2 text-slate-600 dark:text-slate-300\">\r\n                                    <FileText size={20} />\r\n                                    <span className=\"font-medium\">\r\n                                        {selectedIds.size} / {transactions.length}{' '}\r\n                                        {labels.foundTransactions}\r\n                                    </span>\r\n                                </div>\r\n                                <button\r\n                                    onClick={toggleAll}\r\n                                    className=\"text-sm text-blue-600 hover:text-blue-700 font-medium\"\r\n                                >\r\n                                    {labels.selectAll}\r\n                                </button>\r\n                            </div>\r\n\r\n                            <div className=\"border border-slate-200 dark:border-slate-700 rounded-xl overflow-hidden\">\r\n                                <div className=\"max-h-[400px] overflow-auto\">\r\n                                    <table className=\"w-full text-sm\">\r\n                                        <thead className=\"bg-slate-50 dark:bg-slate-800 sticky top-0\">\r\n                                            <tr>\r\n                                                <th className=\"w-10 p-3\"></th>\r\n                                                <th className=\"text-left p-3 font-medium text-slate-600 dark:text-slate-300\">\r\n                                                    {labels.date}\r\n                                                </th>\r\n                                                <th className=\"text-left p-3 font-medium text-slate-600 dark:text-slate-300\">\r\n                                                    {labels.description}\r\n                                                </th>\r\n                                                <th className=\"text-right p-3 font-medium text-slate-600 dark:text-slate-300\">\r\n                                                    {labels.amount}\r\n                                                </th>\r\n                                            </tr>\r\n                                        </thead>\r\n                                        <tbody className=\"divide-y divide-slate-100 dark:divide-slate-700\">\r\n                                            {transactions.map((tx, index) => (\r\n                                                <tr\r\n                                                    key={index}\r\n                                                    className={`\r\n                                                        transition-colors\r\n                                                        ${\r\n                                                            selectedIds.has(index)\r\n                                                                ? 'bg-blue-50 dark:bg-blue-900/20'\r\n                                                                : 'hover:bg-slate-50 dark:hover:bg-slate-800/50'\r\n                                                        }\r\n                                                    `}\r\n                                                >\r\n                                                    <td className=\"p-3 text-center\">\r\n                                                        <input\r\n                                                            type=\"checkbox\"\r\n                                                            checked={selectedIds.has(index)}\r\n                                                            onChange={() => toggleSelection(index)}\r\n                                                            className=\"rounded border-slate-300 text-blue-600 focus:ring-blue-500 cursor-pointer\"\r\n                                                        />\r\n                                                    </td>\r\n                                                    <td className=\"p-3 text-slate-700 dark:text-slate-200 whitespace-nowrap\">\r\n                                                        {tx.date}\r\n                                                    </td>\r\n                                                    <td className=\"p-3 text-slate-700 dark:text-slate-200 truncate max-w-[200px]\">\r\n                                                        {tx.comment}\r\n                                                    </td>\r\n                                                    <td\r\n                                                        className={`p-3 text-right font-medium whitespace-nowrap ${\r\n                                                            tx.type === 'expense'\r\n                                                                ? 'text-red-600 dark:text-red-400'\r\n                                                                : 'text-green-600 dark:text-green-400'\r\n                                                        }`}\r\n                                                    >\r\n                                                        {tx.type === 'expense' ? '-' : '+'}\r\n                                                        {tx.originalAmount.toFixed(2)}{' '}\r\n                                                        {tx.originalCurrency}\r\n                                                    </td>\r\n                                                </tr>\r\n                                            ))}\r\n                                        </tbody>\r\n                                    </table>\r\n                                </div>\r\n                            </div>\r\n\r\n                            {error && (\r\n                                <div className=\"flex items-center gap-3 p-4 bg-red-50 dark:bg-red-900/20 rounded-xl text-red-600 dark:text-red-400\">\r\n                                    <AlertCircle size={20} />\r\n                                    <span>{error}</span>\r\n                                </div>\r\n                            )}\r\n                        </div>\r\n                    )}\r\n\r\n                    {/* Step 3: Result */}\r\n                    {step === 3 && importResult && (\r\n                        <div className=\"text-center py-8\">\r\n                            <CheckCircle size={64} className=\"mx-auto mb-4 text-green-500\" />\r\n                            <h4 className=\"text-xl font-bold text-slate-900 dark:text-white mb-2\">\r\n                                {labels.success}\r\n                            </h4>\r\n                            <p className=\"text-3xl font-bold text-green-600 dark:text-green-400 mb-2\">\r\n                                {importResult.imported} {t.transactions || 'transactions'}\r\n                            </p>\r\n                            {importResult.skipped > 0 && (\r\n                                <p className=\"text-slate-500 dark:text-slate-400\">\r\n                                    {importResult.skipped} {labels.skipped}\r\n                                </p>\r\n                            )}\r\n                        </div>\r\n                    )}\r\n                </div>\r\n\r\n                {/* Footer */}\r\n                <div className=\"flex justify-end gap-3 p-6 border-t border-slate-200 dark:border-slate-700\">\r\n                    {step === 2 && (\r\n                        <>\r\n                            <button\r\n                                onClick={resetState}\r\n                                className=\"px-4 py-2 text-slate-600 dark:text-slate-300 hover:bg-slate-100 dark:hover:bg-slate-800 rounded-xl transition-colors\"\r\n                            >\r\n                                {labels.back}\r\n                            </button>\r\n                            <button\r\n                                onClick={handleImport}\r\n                                disabled={selectedIds.size === 0 || isImporting}\r\n                                className=\"px-6 py-2 bg-blue-600 hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed text-white font-medium rounded-xl transition-colors flex items-center gap-2\"\r\n                            >\r\n                                {isImporting && <Loader2 size={16} className=\"animate-spin\" />}\r\n                                {labels.confirm} ({selectedIds.size})\r\n                            </button>\r\n                        </>\r\n                    )}\r\n                    {step === 3 && (\r\n                        <button\r\n                            onClick={handleClose}\r\n                            className=\"px-6 py-2 bg-blue-600 hover:bg-blue-700 text-white font-medium rounded-xl transition-colors\"\r\n                        >\r\n                            {labels.close}\r\n                        </button>\r\n                    )}\r\n                </div>\r\n            </div>\r\n        </div>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\roman\\Projects\\smart-budget\\src\\components\\modals\\InfoModal.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\roman\\Projects\\smart-budget\\src\\components\\modals\\LinkModal.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\roman\\Projects\\smart-budget\\src\\components\\modals\\LoanModal.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\roman\\Projects\\smart-budget\\src\\components\\modals\\LoanPaymentModal.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\roman\\Projects\\smart-budget\\src\\components\\modals\\ModalManager.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\roman\\Projects\\smart-budget\\src\\components\\modals\\RecurringModal.jsx","messages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useMemo has a missing dependency: 'isOpen'. Either include it or remove the dependency array.","line":29,"column":8,"nodeType":"ArrayExpression","endLine":29,"endColumn":22,"suggestions":[{"desc":"Update the dependencies array to be: [isOpen, transactions]","fix":{"range":[1013,1027],"text":"[isOpen, transactions]"}}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { X, RefreshCw, Calendar, ArrowRight } from 'lucide-react';\r\nimport React, { useMemo } from 'react';\r\n\r\nexport default function RecurringModal({\r\n    isOpen,\r\n    onClose,\r\n    transactions,\r\n    onAdd,\r\n    formatMoney,\r\n    currency,\r\n    t,\r\n}) {\r\n    //     ( ),  \r\n    const uniqueRecurring = useMemo(() => {\r\n        if (!isOpen) return [];\r\n        const map = {};\r\n        transactions.forEach((tx) => {\r\n            if (tx.isRecurring) {\r\n                //   +    \r\n                const key = `${tx.description}-${tx.category}`;\r\n                //        - \r\n                if (!map[key] || new Date(tx.date) > new Date(map[key].date)) {\r\n                    map[key] = tx;\r\n                }\r\n            }\r\n        });\r\n        // :  \r\n        return Object.values(map).sort((a, b) => new Date(b.date) - new Date(a.date));\r\n    }, [transactions]);\r\n\r\n    if (!isOpen) return null;\r\n\r\n    const handleAdd = (tx) => {\r\n        //     \r\n        const newTx = {\r\n            ...tx,\r\n            date: new Date().toISOString().split('T')[0], //  \r\n            createdAt: null, // Firebase   \r\n        };\r\n        //  ID  ,   \r\n        delete newTx.id;\r\n\r\n        onAdd(newTx);\r\n    };\r\n\r\n    return (\r\n        <div className=\"fixed inset-0 bg-black/60 backdrop-blur-sm flex items-center justify-center z-[60] p-4 animate-in fade-in duration-200\">\r\n            <div className=\"bg-white dark:bg-slate-900 w-full max-w-md rounded-2xl p-6 shadow-xl border border-slate-200 dark:border-slate-700 max-h-[80vh] overflow-y-auto\">\r\n                <div className=\"flex justify-between items-center mb-6\">\r\n                    <h3 className=\"font-bold text-lg text-slate-900 dark:text-white flex items-center gap-2\">\r\n                        <RefreshCw size={20} className=\"text-blue-500\" />\r\n                        {t.recurring_title}\r\n                    </h3>\r\n                    <button onClick={onClose}>\r\n                        <X size={20} className=\"text-slate-400\" />\r\n                    </button>\r\n                </div>\r\n\r\n                <div className=\"space-y-3\">\r\n                    {uniqueRecurring.length > 0 ? (\r\n                        uniqueRecurring.map((tx) => (\r\n                            <div\r\n                                key={tx.id}\r\n                                className=\"bg-slate-50 dark:bg-slate-800 p-4 rounded-xl border border-slate-100 dark:border-slate-700 flex justify-between items-center group\"\r\n                            >\r\n                                <div>\r\n                                    <div className=\"font-bold text-slate-900 dark:text-white\">\r\n                                        {tx.description}\r\n                                    </div>\r\n                                    <div className=\"text-xs text-slate-500 flex items-center gap-1 mt-1\">\r\n                                        <Calendar size={10} /> {t.last_payment} {tx.date}\r\n                                    </div>\r\n                                    <div className=\"font-bold text-sm mt-1 text-slate-700 dark:text-slate-300\">\r\n                                        {formatMoney(tx.amount, currency)}\r\n                                    </div>\r\n                                </div>\r\n                                <button\r\n                                    onClick={() => handleAdd(tx)}\r\n                                    className=\"bg-white dark:bg-slate-700 hover:bg-blue-50 dark:hover:bg-blue-900/30 text-blue-600 border border-slate-200 dark:border-slate-600 px-3 py-2 rounded-lg text-xs font-bold transition-all flex items-center gap-1 shadow-sm\"\r\n                                >\r\n                                    {t.add_now} <ArrowRight size={12} />\r\n                                </button>\r\n                            </div>\r\n                        ))\r\n                    ) : (\r\n                        <div className=\"text-center text-slate-400 py-8 text-sm\">\r\n                            {t.recurring_empty}\r\n                        </div>\r\n                    )}\r\n                </div>\r\n            </div>\r\n        </div>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\roman\\Projects\\smart-budget\\src\\components\\modals\\SettingsModal.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\roman\\Projects\\smart-budget\\src\\components\\modals\\TransactionModal.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\roman\\Projects\\smart-budget\\src\\components\\modals\\settings\\CategoryRulesManager.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\roman\\Projects\\smart-budget\\src\\components\\modals\\settings\\GeminiSettings.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\roman\\Projects\\smart-budget\\src\\components\\modals\\settings\\GeneralSettings.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\roman\\Projects\\smart-budget\\src\\components\\modals\\settings\\LimitsManager.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\roman\\Projects\\smart-budget\\src\\components\\modals\\settings\\ProfileSettings.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\roman\\Projects\\smart-budget\\src\\components\\modals\\settings\\RequestsManager.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\roman\\Projects\\smart-budget\\src\\components\\modals\\settings\\TeamManager.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\roman\\Projects\\smart-budget\\src\\components\\ui\\Button.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\roman\\Projects\\smart-budget\\src\\components\\ui\\Input.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\roman\\Projects\\smart-budget\\src\\components\\ui\\ModalWrapper.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\roman\\Projects\\smart-budget\\src\\components\\views\\AssetItem.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\roman\\Projects\\smart-budget\\src\\components\\views\\AssetsView.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\roman\\Projects\\smart-budget\\src\\components\\views\\BudgetView.jsx","messages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'lang'. Either include it or remove the dependency array.","line":103,"column":8,"nodeType":"ArrayExpression","endLine":103,"endColumn":18,"suggestions":[{"desc":"Update the dependencies array to be: [currency, lang]","fix":{"range":[3593,3603],"text":"[currency, lang]"}}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { doc, updateDoc, writeBatch, collection, getDocs, query } from 'firebase/firestore';\r\nimport { Plus, BarChart3 } from 'lucide-react';\r\nimport React, { useState, useMemo, useRef, Suspense, lazy, useEffect } from 'react';\r\n\r\nimport { db, appId } from '../../firebase';\r\nimport { useTransactionTotals } from '../../hooks/useTransactionTotals';\r\nimport { BudgetProgress } from '../BudgetProgress';\r\nimport ConfirmModal from '../modals/ConfirmModal';\r\n\r\nimport BudgetCharts from './budget/BudgetCharts';\r\nimport BudgetSummaryCards from './budget/BudgetSummaryCards';\r\nimport BudgetToolbar from './budget/BudgetToolbar';\r\nimport TransactionList from './budget/TransactionList';\r\n\r\n// Mobile-only chart import can remain lazily or be moved. Charts inside BudgetCharts are already lazy.\r\n// We need the mobile second chart? Line 270 in original...\r\nconst SimpleBarChart = lazy(() =>\r\n    import('../Charts').then((module) => ({ default: module.SimpleBarChart }))\r\n);\r\nconst MonobankConnect = lazy(() => import('../integrations/MonobankConnect'));\r\n\r\nconst Skeleton = ({ className }) => (\r\n    <div className={`animate-pulse bg-slate-200 dark:bg-slate-800 rounded-xl ${className}`}></div>\r\n);\r\n\r\nexport default function BudgetView({\r\n    activeBudgetId,\r\n    transactions,\r\n    categories,\r\n    limits,\r\n    currency,\r\n    formatMoney,\r\n    t,\r\n    onOpenSettings,\r\n    onOpenInvite,\r\n    onOpenRecurring,\r\n    onOpenImport,\r\n    onAddTransaction,\r\n    onEditTransaction,\r\n    onDeleteTransaction,\r\n    onExport,\r\n    onOpenJoin,\r\n    getCategoryStyles,\r\n    getCategoryName,\r\n    lang,\r\n    currentBalance,\r\n    loadMore,\r\n    hasMore,\r\n    onSaveTransaction, // Passed from AppRoutes\r\n}) {\r\n    const [timeFilter, setTimeFilter] = useState('all');\r\n    const [customStartDate, setCustomStartDate] = useState('');\r\n    const [customEndDate, setCustomEndDate] = useState('');\r\n    const [searchTerm, setSearchTerm] = useState('');\r\n    const [historyFilter, setHistoryFilter] = useState('all');\r\n    const [isConfirmClearOpen, setIsConfirmClearOpen] = useState(false);\r\n    const historyRef = useRef(null);\r\n\r\n    // Server-side aggregated totals\r\n    const {\r\n        totalIncome: rawIncome,\r\n        totalExpense: rawExpense,\r\n        loading: totalsLoading,\r\n    } = useTransactionTotals(activeBudgetId, timeFilter, customStartDate, customEndDate);\r\n\r\n    // Exchange Rate State\r\n    const [exchangeRate, setExchangeRate] = useState(1);\r\n\r\n    // Fetch Exchange Rate\r\n    useEffect(() => {\r\n        let isActive = true;\r\n        const fetchRate = async () => {\r\n            // Default to 1 if currencies match\r\n            if (currency === 'EUR' || (currency === 'UAH' && lang === 'ua')) {\r\n                // Assuming base is EUR, but check logic\r\n                // Actually logic says STORAGE_CURRENCY = 'EUR'\r\n            }\r\n\r\n            const STORAGE_CURRENCY = 'EUR';\r\n            if (currency === STORAGE_CURRENCY) {\r\n                if (isActive) setExchangeRate(1);\r\n                return;\r\n            }\r\n\r\n            try {\r\n                const { fetchExchangeRateCached } = await import('../../utils/currency');\r\n                const rate = await fetchExchangeRateCached(STORAGE_CURRENCY, currency);\r\n\r\n                if (isActive) {\r\n                    setExchangeRate(rate);\r\n                }\r\n            } catch (e) {\r\n                console.error('Conversion error in BudgetView:', e);\r\n                if (isActive) setExchangeRate(1);\r\n            }\r\n        };\r\n\r\n        fetchRate();\r\n\r\n        return () => {\r\n            isActive = false;\r\n        };\r\n    }, [currency]);\r\n\r\n    // Derived totals (always consistent with exchangeRate)\r\n    const totalIncome = useMemo(() => rawIncome * exchangeRate, [rawIncome, exchangeRate]);\r\n    const totalExpense = useMemo(() => rawExpense * exchangeRate, [rawExpense, exchangeRate]);\r\n\r\n    const isCustomRange = timeFilter === 'custom';\r\n\r\n    const filteredTransactions = useMemo(() => {\r\n        const now = new Date();\r\n        const currentMonth = now.getMonth();\r\n        const currentYear = now.getFullYear();\r\n\r\n        const getStartOfDay = (dateStr) => {\r\n            const d = new Date(dateStr);\r\n            d.setHours(0, 0, 0, 0);\r\n            return d;\r\n        };\r\n\r\n        let list = transactions.filter((t) => {\r\n            const d = new Date(t.date);\r\n\r\n            if (timeFilter === 'this_month') {\r\n                return d.getMonth() === currentMonth && d.getFullYear() === currentYear;\r\n            }\r\n            if (timeFilter === 'last_month') {\r\n                const last = new Date(currentYear, currentMonth - 1, 1);\r\n                return d.getMonth() === last.getMonth() && d.getFullYear() === last.getFullYear();\r\n            }\r\n            if (timeFilter === 'this_year') {\r\n                return d.getFullYear() === currentYear;\r\n            }\r\n            if (timeFilter === 'custom') {\r\n                if (!customStartDate && !customEndDate) return true;\r\n                const txDate = getStartOfDay(t.date);\r\n                const start = customStartDate\r\n                    ? getStartOfDay(customStartDate)\r\n                    : new Date('1970-01-01');\r\n                const end = customEndDate ? getStartOfDay(customEndDate) : new Date('9999-12-31');\r\n                return txDate >= start && txDate <= end;\r\n            }\r\n            return true;\r\n        });\r\n\r\n        if (historyFilter !== 'all') {\r\n            list = list.filter((t) => t.type === historyFilter);\r\n        }\r\n\r\n        if (searchTerm) {\r\n            const lowerTerm = searchTerm.toLowerCase();\r\n            list = list.filter((t) =>\r\n                (t.description || t.comment || '').toLowerCase().includes(lowerTerm)\r\n            );\r\n        }\r\n\r\n        return list;\r\n    }, [transactions, timeFilter, searchTerm, historyFilter, customStartDate, customEndDate]);\r\n\r\n    const handleToggleHidden = async (transaction) => {\r\n        try {\r\n            const txRef = doc(\r\n                db,\r\n                'artifacts',\r\n                appId,\r\n                'users',\r\n                activeBudgetId,\r\n                'transactions',\r\n                transaction.id\r\n            );\r\n            await updateDoc(txRef, {\r\n                isHidden: !transaction.isHidden,\r\n            });\r\n            // toast.success(t.success_update || 'Updated'); // Toast not imported?\r\n        } catch (error) {\r\n            console.error('Error toggling hidden:', error);\r\n        }\r\n    };\r\n\r\n    // expensesByCategory is calculated from visible filtered transactions for charts\r\n    const expensesByCategory = useMemo(() => {\r\n        const expenseMap = {};\r\n\r\n        filteredTransactions.forEach((t) => {\r\n            if (t.type === 'expense' && t.category && !t.isHidden) {\r\n                const amount = Number(t.amount) || 0;\r\n                expenseMap[t.category] = (expenseMap[t.category] || 0) + amount;\r\n            }\r\n        });\r\n\r\n        return categories\r\n            .filter((c) => c.type === 'expense')\r\n            .map((c) => {\r\n                const rawTotal = expenseMap[c.id] || 0;\r\n                // Apply exchange rate\r\n                const total = rawTotal * exchangeRate;\r\n                return { ...c, total };\r\n            })\r\n            .filter((x) => x.total > 0)\r\n            .sort((a, b) => b.total - a.total);\r\n    }, [filteredTransactions, categories, exchangeRate]);\r\n\r\n    const trendsData = useMemo(() => {\r\n        // Dynamic trends based on timeFilter\r\n        // if timeFilter is short (month), show Days.\r\n        // if timeFilter is long (year), show Months.\r\n        // if 'all', show Years or Months depending on span.\r\n\r\n        let mode = 'month';\r\n        if (timeFilter === 'this_month' || timeFilter === 'last_month') mode = 'day';\r\n        else if (timeFilter === 'this_year') mode = 'month';\r\n        else if (timeFilter === 'custom') {\r\n            const start = customStartDate ? new Date(customStartDate) : new Date();\r\n            const end = customEndDate ? new Date(customEndDate) : new Date();\r\n            const diffDays = Math.abs((end - start) / (1000 * 60 * 60 * 24));\r\n            mode = diffDays < 62 ? 'day' : 'month';\r\n        } else if (timeFilter === 'all') {\r\n            mode = 'month'; // Default to month for all time usually looks best unless very long history\r\n        }\r\n\r\n        const map = new Map();\r\n\r\n        // sort transactions by date first to ensure order if we iterate\r\n        // actually we can just map and then sort keys\r\n        filteredTransactions.forEach((t) => {\r\n            // Use FILTERED transactions for Trends to match user current view\r\n            if (!t.date || t.isHidden) return;\r\n            const d = new Date(t.date);\r\n            let key, label;\r\n\r\n            if (mode === 'day') {\r\n                key = `${d.getFullYear()}-${String(d.getMonth() + 1).padStart(2, '0')}-${String(d.getDate()).padStart(2, '0')}`;\r\n                label = d.toLocaleDateString(lang === 'ua' ? 'uk-UA' : 'en-US', {\r\n                    day: 'numeric',\r\n                    month: 'short',\r\n                });\r\n            } else if (mode === 'month') {\r\n                key = `${d.getFullYear()}-${String(d.getMonth() + 1).padStart(2, '0')}`;\r\n                label = d.toLocaleString(lang === 'ua' ? 'uk-UA' : 'en-US', {\r\n                    month: 'short',\r\n                    year: 'numeric',\r\n                });\r\n            } else {\r\n                key = `${d.getFullYear()}`;\r\n                label = `${d.getFullYear()}`;\r\n            }\r\n\r\n            if (!map.has(key)) map.set(key, { key, label, income: 0, expense: 0 });\r\n            const bucket = map.get(key);\r\n            const val = (Number(t.amount) || 0) * exchangeRate;\r\n\r\n            // Rounding happens at display time or here. Let's keep high precision here.\r\n            if (t.type === 'income') bucket.income += val;\r\n            else if (t.type === 'expense') bucket.expense += val;\r\n        });\r\n\r\n        // Fill gaps if 'day' mode and within standard ranges?\r\n        // For simplicity and \"Vibe\", let's just sort the existing data points.\r\n        // If user wants to see empty days, we can add loop later.\r\n        // But for \"Trends\", seeing the flow is enough.\r\n\r\n        return Array.from(map.values()).sort((a, b) => a.key.localeCompare(b.key));\r\n    }, [filteredTransactions, timeFilter, lang, exchangeRate, customStartDate, customEndDate]);\r\n\r\n    const handleClearHistory = async () => {\r\n        try {\r\n            // Delete ALL transactions for this budget visible in \"All Time\"\r\n            // Or really ALL in Firestore? User said \"Clear History\" -> implies current budget.\r\n            // Safe approach: Delete from Firestore collection.\r\n\r\n            const q = query(\r\n                collection(db, 'artifacts', appId, 'users', activeBudgetId, 'transactions')\r\n            );\r\n            const snapshot = await getDocs(q);\r\n\r\n            if (snapshot.empty) return;\r\n\r\n            // Batch delete\r\n            const batches = [];\r\n            let batch = writeBatch(db);\r\n            let count = 0;\r\n\r\n            snapshot.docs.forEach((doc) => {\r\n                batch.delete(doc.ref);\r\n                count++;\r\n                if (count >= 400) {\r\n                    batches.push(batch.commit());\r\n                    batch = writeBatch(db);\r\n                    count = 0;\r\n                }\r\n            });\r\n            if (count > 0) batches.push(batch.commit());\r\n\r\n            await Promise.all(batches);\r\n\r\n            // Also reset currentBalance to 0 in the budget document\r\n            // To get budget doc path, we need to know where it is.\r\n            // In usageBudgetData: doc(db, 'artifacts', appId, 'public', 'data', 'budgets', activeBudgetId)\r\n            const budgetDocRef = doc(\r\n                db,\r\n                'artifacts',\r\n                appId,\r\n                'public',\r\n                'data',\r\n                'budgets',\r\n                activeBudgetId\r\n            );\r\n            await updateDoc(budgetDocRef, {\r\n                currentBalance: 0,\r\n            });\r\n\r\n            // UI should update automatically via real-time listeners if logic uses them.\r\n            // BudgetView uses `transactions` prop. If it comes from onSnapshot, it will clear.\r\n        } catch (error) {\r\n            console.error('Failed to clear history:', error);\r\n            // Maybe alert user\r\n        }\r\n    };\r\n\r\n    const displayBalance = currentBalance || 0;\r\n\r\n    const handleCardClick = (filterType) => {\r\n        setHistoryFilter(filterType);\r\n        setTimeout(() => {\r\n            historyRef.current?.scrollIntoView({ behavior: 'smooth' });\r\n        }, 50);\r\n    };\r\n\r\n    return (\r\n        <>\r\n            <BudgetToolbar\r\n                timeFilter={timeFilter}\r\n                setTimeFilter={setTimeFilter}\r\n                searchTerm={searchTerm}\r\n                setSearchTerm={setSearchTerm}\r\n                isCustomRange={isCustomRange}\r\n                customStartDate={customStartDate}\r\n                setCustomStartDate={setCustomStartDate}\r\n                customEndDate={customEndDate}\r\n                setCustomEndDate={setCustomEndDate}\r\n                t={t}\r\n                onRecurring={onOpenRecurring}\r\n                onInvite={onOpenInvite}\r\n                onJoin={onOpenJoin}\r\n                onImport={onOpenImport}\r\n            />\r\n\r\n            <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 mb-4\">\r\n                <div>\r\n                    <BudgetProgress\r\n                        categories={categories}\r\n                        transactions={transactions}\r\n                        limits={limits}\r\n                        currency={currency}\r\n                        formatMoney={formatMoney}\r\n                        onOpenSettings={onOpenSettings}\r\n                        label={t.limits_title}\r\n                    />\r\n                </div>\r\n                <div className=\"col-span-1 md:col-span-1 lg:col-span-2\">\r\n                    <Suspense fallback={<Skeleton className=\"h-full w-full\" />}>\r\n                        <MonobankConnect\r\n                            lang={lang}\r\n                            onSyncTransactions={(tx) => onSaveTransaction(tx, null)}\r\n                            existingTransactions={transactions}\r\n                        />\r\n                    </Suspense>\r\n                </div>\r\n            </div>\r\n\r\n            <BudgetSummaryCards\r\n                displayBalance={displayBalance}\r\n                income={totalIncome}\r\n                expense={totalExpense}\r\n                loading={totalsLoading}\r\n                currency={currency}\r\n                formatMoney={formatMoney}\r\n                t={t}\r\n                onCardClick={handleCardClick}\r\n            />\r\n\r\n            <div className=\"grid lg:grid-cols-3 gap-4\">\r\n                <BudgetCharts\r\n                    expensesByCategory={expensesByCategory}\r\n                    expense={totalExpense}\r\n                    trendsData={trendsData}\r\n                    currency={currency}\r\n                    formatMoney={formatMoney}\r\n                    t={t}\r\n                    getCategoryName={getCategoryName}\r\n                />\r\n\r\n                <div\r\n                    className=\"lg:col-span-2 bg-white dark:bg-slate-900 rounded-2xl overflow-hidden flex flex-col h-[600px] lg:h-[765px] shadow-sm border border-slate-100 dark:border-slate-800\"\r\n                    ref={historyRef}\r\n                >\r\n                    <TransactionList\r\n                        transactions={filteredTransactions}\r\n                        onEdit={onEditTransaction}\r\n                        onDelete={onDeleteTransaction}\r\n                        onExport={onExport}\r\n                        getCategoryStyles={getCategoryStyles}\r\n                        formatMoney={formatMoney}\r\n                        currency={currency}\r\n                        t={t}\r\n                        hasMore={hasMore}\r\n                        loadMore={loadMore}\r\n                        historyFilter={historyFilter}\r\n                        setHistoryFilter={setHistoryFilter}\r\n                        isCustomRange={isCustomRange}\r\n                        lang={lang}\r\n                        // exchangeRate removed - transactions already converted\r\n                        onToggleHidden={handleToggleHidden}\r\n                        onClearHistory={() => setIsConfirmClearOpen(true)}\r\n                    />\r\n                </div>\r\n\r\n                <div className=\"block lg:hidden bg-white dark:bg-slate-900 p-5 rounded-2xl shadow-sm border border-slate-100 dark:border-slate-800 min-h-[300px]\">\r\n                    <h3 className=\"font-bold text-lg mb-4 flex items-center gap-2 text-slate-900 dark:text-white\">\r\n                        <BarChart3 className=\"text-blue-600 dark:text-blue-400\" size={20} />{' '}\r\n                        {t.trends_title}\r\n                    </h3>\r\n                    <div className=\"h-[200px]\">\r\n                        <Suspense fallback={<Skeleton className=\"w-full h-full rounded-2xl\" />}>\r\n                            <SimpleBarChart data={trendsData} currency={currency} />\r\n                        </Suspense>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n            <button\r\n                onClick={onAddTransaction}\r\n                className=\"fixed bottom-6 right-6 bg-blue-600 text-white p-4 rounded-full shadow-lg hover:scale-105 transition-transform z-50\"\r\n                aria-label={t.add_transaction || 'Add transaction'}\r\n            >\r\n                <Plus size={28} />\r\n            </button>\r\n            <ConfirmModal\r\n                isOpen={isConfirmClearOpen}\r\n                onClose={() => setIsConfirmClearOpen(false)}\r\n                onConfirm={handleClearHistory}\r\n                title={t.confirm_clear_history_title}\r\n                message={t.confirm_clear_history_msg}\r\n                t={{\r\n                    btn_cancel: t.btn_cancel || 'Cancel',\r\n                    btn_confirm: t.btn_confirm || 'Delete All',\r\n                }}\r\n            />\r\n        </>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\roman\\Projects\\smart-budget\\src\\components\\views\\CreditsView.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\roman\\Projects\\smart-budget\\src\\components\\views\\LoanItem.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\roman\\Projects\\smart-budget\\src\\components\\views\\budget\\BudgetCharts.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\roman\\Projects\\smart-budget\\src\\components\\views\\budget\\BudgetSummaryCards.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\roman\\Projects\\smart-budget\\src\\components\\views\\budget\\BudgetToolbar.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\roman\\Projects\\smart-budget\\src\\components\\views\\budget\\TransactionItem.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\roman\\Projects\\smart-budget\\src\\components\\views\\budget\\TransactionList.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\roman\\Projects\\smart-budget\\src\\constants.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\roman\\Projects\\smart-budget\\src\\context\\CurrencyContext.jsx","messages":[{"ruleId":"react-refresh/only-export-components","severity":1,"message":"Fast refresh only works when a file only exports components. Use a new file to share constants or functions between components.","line":7,"column":14,"nodeType":"Identifier","messageId":"namedExport","endLine":7,"endColumn":25}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { createContext, useState, useEffect, useContext } from 'react';\r\n\r\nimport { CURRENCIES } from '../constants';\r\n\r\nconst CurrencyContext = createContext();\r\n\r\nexport const useCurrency = () => {\r\n    const context = useContext(CurrencyContext);\r\n    if (!context) {\r\n        throw new Error('useCurrency must be used within a CurrencyProvider');\r\n    }\r\n    return context;\r\n};\r\n\r\nexport const CurrencyProvider = ({ children }) => {\r\n    //   localStorage\r\n    const [currency, setCurrency] = useState(() => localStorage.getItem('currency') || 'EUR');\r\n\r\n    //   localStorage\r\n    useEffect(() => {\r\n        localStorage.setItem('currency', currency);\r\n    }, [currency]);\r\n\r\n    //   formatMoney  App.jsx \r\n    //      currency  (  currencyCode ),\r\n    //      .\r\n    const formatMoney = (amount, currencyCode) => {\r\n        const symbol = CURRENCIES[currencyCode]?.symbol || '$';\r\n        return `${symbol}${Math.abs(amount).toFixed(2)}`;\r\n    };\r\n\r\n    const value = {\r\n        currency,\r\n        setCurrency,\r\n        formatMoney,\r\n    };\r\n\r\n    return <CurrencyContext.Provider value={value}>{children}</CurrencyContext.Provider>;\r\n};\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\roman\\Projects\\smart-budget\\src\\context\\LanguageContext.jsx","messages":[{"ruleId":"react-refresh/only-export-components","severity":1,"message":"Fast refresh only works when a file only exports components. Use a new file to share constants or functions between components.","line":7,"column":14,"nodeType":"Identifier","messageId":"namedExport","endLine":7,"endColumn":25}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { createContext, useState, useEffect, useContext } from 'react';\r\n\r\nimport { TRANSLATIONS } from '../translations';\r\n\r\nconst LanguageContext = createContext();\r\n\r\nexport const useLanguage = () => {\r\n    const context = useContext(LanguageContext);\r\n    if (!context) {\r\n        throw new Error('useLanguage must be used within a LanguageProvider');\r\n    }\r\n    return context;\r\n};\r\n\r\nexport const LanguageProvider = ({ children }) => {\r\n    //   localStorage,    App.jsx\r\n    const [lang, setLang] = useState(() => localStorage.getItem('lang') || 'ua');\r\n\r\n    //   localStorage\r\n    useEffect(() => {\r\n        localStorage.setItem('lang', lang);\r\n    }, [lang]);\r\n\r\n    //   \r\n    const t = TRANSLATIONS[lang] || TRANSLATIONS['ua'];\r\n\r\n    const value = {\r\n        lang,\r\n        setLang,\r\n        t,\r\n    };\r\n\r\n    return <LanguageContext.Provider value={value}>{children}</LanguageContext.Provider>;\r\n};\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\roman\\Projects\\smart-budget\\src\\context\\ThemeContext.jsx","messages":[{"ruleId":"react-refresh/only-export-components","severity":1,"message":"Fast refresh only works when a file only exports components. Use a new file to share constants or functions between components.","line":5,"column":14,"nodeType":"Identifier","messageId":"namedExport","endLine":5,"endColumn":22}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { createContext, useState, useEffect, useContext } from 'react';\r\n\r\nconst ThemeContext = createContext();\r\n\r\nexport const useTheme = () => {\r\n    const context = useContext(ThemeContext);\r\n    if (!context) {\r\n        throw new Error('useTheme must be used within a ThemeProvider');\r\n    }\r\n    return context;\r\n};\r\n\r\nexport const ThemeProvider = ({ children }) => {\r\n    // Initialize from localStorage to prevent flash of wrong theme\r\n    const [darkMode, setDarkMode] = useState(() => {\r\n        if (typeof window !== 'undefined') {\r\n            return localStorage.getItem('theme') === 'dark';\r\n        }\r\n        return false;\r\n    });\r\n\r\n    // Sync with DOM and localStorage whenever state changes\r\n    useEffect(() => {\r\n        const root = document.documentElement;\r\n        if (darkMode) {\r\n            root.classList.add('dark');\r\n            localStorage.setItem('theme', 'dark');\r\n        } else {\r\n            root.classList.remove('dark');\r\n            localStorage.setItem('theme', 'light');\r\n        }\r\n    }, [darkMode]);\r\n\r\n    const toggleTheme = () => {\r\n        setDarkMode((prev) => !prev);\r\n    };\r\n\r\n    const value = {\r\n        darkMode,\r\n        setDarkMode,\r\n        toggleTheme,\r\n    };\r\n\r\n    return <ThemeContext.Provider value={value}>{children}</ThemeContext.Provider>;\r\n};\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\roman\\Projects\\smart-budget\\src\\firebase.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\roman\\Projects\\smart-budget\\src\\hooks\\useAppActions.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\roman\\Projects\\smart-budget\\src\\hooks\\useAssets.js","messages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'getAssetsColRef'. Either include it or remove the dependency array.","line":31,"column":8,"nodeType":"ArrayExpression","endLine":31,"endColumn":24,"suggestions":[{"desc":"Update the dependencies array to be: [activeBudgetId, getAssetsColRef]","fix":{"range":[971,987],"text":"[activeBudgetId, getAssetsColRef]"}}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import {\r\n    collection,\r\n    onSnapshot,\r\n    addDoc,\r\n    updateDoc,\r\n    deleteDoc,\r\n    doc,\r\n    serverTimestamp,\r\n} from 'firebase/firestore';\r\nimport { useState, useEffect } from 'react';\r\nimport { toast } from 'react-hot-toast';\r\n\r\nimport { db, appId } from '../firebase';\r\nimport { fetchExchangeRate } from '../utils/currency';\r\n\r\nexport const useAssets = (activeBudgetId, currency, t) => {\r\n    const [assets, setAssets] = useState([]);\r\n    const [rawAssets, setRawAssets] = useState([]);\r\n\r\n    const getAssetsColRef = () =>\r\n        collection(db, 'artifacts', appId, 'public', 'data', 'budgets', activeBudgetId, 'assets');\r\n\r\n    // Listen\r\n    useEffect(() => {\r\n        if (!activeBudgetId) return;\r\n        const unsubscribe = onSnapshot(getAssetsColRef(), (snapshot) => {\r\n            const items = snapshot.docs.map((doc) => ({ id: doc.id, ...doc.data() }));\r\n            setRawAssets(items);\r\n        });\r\n        return () => unsubscribe();\r\n    }, [activeBudgetId]);\r\n\r\n    // Convert assets to display currency\r\n    useEffect(() => {\r\n        let isMounted = true;\r\n        const convertAssets = async () => {\r\n            const converted = await Promise.all(\r\n                rawAssets.map(async (a) => {\r\n                    let convertedValue = a.amount || 0;\r\n                    const assetCurrency = a.currency || a.originalCurrency || 'USD'; // Default to USD if missing (common for assets)\r\n\r\n                    // Convert to display currency\r\n                    if (a.type === 'crypto' && a.cryptoId) {\r\n                        try {\r\n                            const rate = await fetchExchangeRate(a.cryptoId, currency, true);\r\n                            if (rate)\r\n                                convertedValue = Math.round((a.amount || 0) * rate * 100) / 100;\r\n                        } catch (e) {\r\n                            console.error('Failed to convert crypto asset:', e);\r\n                            // Fallback: assume 1\r\n                            convertedValue = Math.round((a.amount || 0) * 100) / 100;\r\n                        }\r\n                    } else if (assetCurrency && assetCurrency !== currency) {\r\n                        try {\r\n                            const rate = await fetchExchangeRate(assetCurrency, currency);\r\n                            if (rate)\r\n                                convertedValue =\r\n                                    Math.round(\r\n                                        (a.amount || 0) * (a.valuePerUnit || 1) * rate * 100\r\n                                    ) / 100;\r\n                        } catch (e) {\r\n                            console.error('Failed to convert asset:', e);\r\n                            // Fallback: keep original value but it might be wrong scale\r\n                            convertedValue =\r\n                                Math.round((a.amount || 0) * (a.valuePerUnit || 1) * 100) / 100;\r\n                        }\r\n                    } else {\r\n                        // Same currency - just multiply amount by valuePerUnit and round\r\n                        convertedValue =\r\n                            Math.round((a.amount || 0) * (a.valuePerUnit || 1) * 100) / 100;\r\n                    }\r\n\r\n                    return { ...a, convertedValue };\r\n                })\r\n            );\r\n            if (isMounted) setAssets(converted);\r\n        };\r\n        convertAssets();\r\n        return () => {\r\n            isMounted = false;\r\n        };\r\n    }, [rawAssets, currency]);\r\n\r\n    const addAsset = async (data) => {\r\n        if (!activeBudgetId) return;\r\n        await addDoc(getAssetsColRef(), {\r\n            ...data,\r\n            createdAt: serverTimestamp(),\r\n        });\r\n    };\r\n\r\n    const updateAsset = async (id, data) => {\r\n        if (!activeBudgetId) return;\r\n        await updateDoc(doc(getAssetsColRef(), id), { ...data, updatedAt: serverTimestamp() });\r\n    };\r\n\r\n    const deleteAsset = async (id) => {\r\n        if (!confirm(t.confirm_delete || 'Delete?')) return;\r\n        await deleteDoc(doc(getAssetsColRef(), id));\r\n        toast.success(t.success_delete || 'Deleted');\r\n    };\r\n\r\n    return {\r\n        assets,\r\n        addAsset,\r\n        updateAsset,\r\n        deleteAsset,\r\n    };\r\n};\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\roman\\Projects\\smart-budget\\src\\hooks\\useAuth.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":154,"column":59,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":154,"endColumn":62,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5935,5938],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5935,5938],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import {\r\n    onAuthStateChanged,\r\n    signInWithEmailAndPassword,\r\n    createUserWithEmailAndPassword,\r\n    signOut,\r\n    sendPasswordResetEmail,\r\n    updateProfile,\r\n    GoogleAuthProvider,\r\n    signInWithPopup,\r\n    sendEmailVerification,\r\n    User,\r\n    UserCredential,\r\n} from 'firebase/auth';\r\nimport { doc, setDoc, onSnapshot, Unsubscribe } from 'firebase/firestore';\r\nimport { useState, useEffect, useCallback } from 'react';\r\n\r\nimport { auth, db, appId } from '../firebase';\r\n\r\nexport interface AuthState {\r\n    user: User | null;\r\n    loading: boolean;\r\n    activeBudgetId: string | null;\r\n    isPendingApproval: boolean;\r\n    login: (email: string, password: string) => Promise<UserCredential>;\r\n    register: (email: string, password: string, name: string) => Promise<User>;\r\n    logout: () => Promise<void>;\r\n    resetPassword: (email: string) => Promise<void>;\r\n    googleLogin: () => Promise<User>;\r\n    resendVerificationEmail: () => Promise<void>;\r\n}\r\n\r\nexport const useAuth = (): AuthState => {\r\n    const [user, setUser] = useState<User | null>(null);\r\n    const [loading, setLoading] = useState<boolean>(true);\r\n    const [activeBudgetId, setActiveBudgetId] = useState<string | null>(null);\r\n    const [isPendingApproval, setIsPendingApproval] = useState<boolean>(false);\r\n\r\n    useEffect(() => {\r\n        let profileUnsubscribe: Unsubscribe | null = null;\r\n\r\n        const authUnsubscribe = onAuthStateChanged(auth, async (currentUser) => {\r\n            if (currentUser) {\r\n                // Reload user to get fresh token/claims if needed\r\n                setUser(currentUser);\r\n\r\n                const userRef = doc(\r\n                    db,\r\n                    'artifacts',\r\n                    appId,\r\n                    'users',\r\n                    currentUser.uid,\r\n                    'metadata',\r\n                    'profile'\r\n                );\r\n\r\n                // Real-time listener for user profile changes\r\n                profileUnsubscribe = onSnapshot(\r\n                    userRef,\r\n                    async (docSnap) => {\r\n                        if (docSnap.exists()) {\r\n                            const data = docSnap.data();\r\n                            setActiveBudgetId(data.activeBudgetId || currentUser.uid);\r\n                            setIsPendingApproval(data.isPendingApproval || false);\r\n                        } else {\r\n                            // Create profile if it doesn't exist (fail-safe)\r\n                            try {\r\n                                await setDoc(userRef, {\r\n                                    email: currentUser.email,\r\n                                    displayName: currentUser.displayName || '',\r\n                                    photoURL: currentUser.photoURL || '',\r\n                                    createdAt: new Date(),\r\n                                    activeBudgetId: currentUser.uid,\r\n                                    isPendingApproval: false,\r\n                                });\r\n                                setActiveBudgetId(currentUser.uid);\r\n                            } catch (e) {\r\n                                console.error('Error creating profile:', e);\r\n                            }\r\n                        }\r\n                        setLoading(false);\r\n                    },\r\n                    (error) => {\r\n                        console.error('Profile sync error:', error);\r\n                        setLoading(false);\r\n                    }\r\n                );\r\n            } else {\r\n                setUser(null);\r\n                setActiveBudgetId(null);\r\n                setIsPendingApproval(false);\r\n                setLoading(false);\r\n                if (profileUnsubscribe) profileUnsubscribe();\r\n            }\r\n        });\r\n\r\n        return () => {\r\n            authUnsubscribe();\r\n            if (profileUnsubscribe) profileUnsubscribe();\r\n        };\r\n    }, []);\r\n\r\n    const login = async (email: string, password: string) => {\r\n        return signInWithEmailAndPassword(auth, email, password);\r\n    };\r\n\r\n    const register = async (email: string, password: string, name: string) => {\r\n        const res = await createUserWithEmailAndPassword(auth, email, password);\r\n\r\n        // 1. Update display name immediately\r\n        await updateProfile(res.user, { displayName: name });\r\n\r\n        // 2. Create the user document immediately explicitly\r\n        await setDoc(doc(db, 'artifacts', appId, 'users', res.user.uid, 'metadata', 'profile'), {\r\n            email,\r\n            displayName: name,\r\n            createdAt: new Date(),\r\n            activeBudgetId: res.user.uid,\r\n            isPendingApproval: false,\r\n        });\r\n\r\n        // 3. Send verification email with explicit error handling\r\n        try {\r\n            await sendEmailVerification(res.user);\r\n            console.log('Verification email sent successfully to:', email);\r\n        } catch (e) {\r\n            console.error('Error sending verification email (Critical):', e);\r\n            // We don't throw here to allow the user to be logged in,\r\n            // but we log it clearly.\r\n        }\r\n\r\n        return res.user;\r\n    };\r\n\r\n    // NEW: Function to manually resend email\r\n    const resendVerificationEmail = async () => {\r\n        if (auth.currentUser) {\r\n            await sendEmailVerification(auth.currentUser);\r\n            console.log('Resend verification email triggered.');\r\n        } else {\r\n            throw new Error('No user logged in to send verification email to.');\r\n        }\r\n    };\r\n\r\n    const googleLogin = useCallback(async () => {\r\n        const provider = new GoogleAuthProvider();\r\n        provider.setCustomParameters({\r\n            prompt: 'select_account',\r\n        });\r\n\r\n        try {\r\n            const result = await signInWithPopup(auth, provider);\r\n            return result.user;\r\n        } catch (error) {\r\n            console.error('Google Login Error:', error as any);\r\n            throw error;\r\n        }\r\n    }, []);\r\n\r\n    const logout = async () => signOut(auth);\r\n    const resetPassword = async (email: string) => sendPasswordResetEmail(auth, email);\r\n\r\n    return {\r\n        user,\r\n        loading,\r\n        activeBudgetId,\r\n        isPendingApproval,\r\n        login,\r\n        register,\r\n        logout,\r\n        resetPassword,\r\n        googleLogin,\r\n        resendVerificationEmail,\r\n    };\r\n};\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\roman\\Projects\\smart-budget\\src\\hooks\\useBudget.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":18,"column":11,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":18,"endColumn":14,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[641,644],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[641,644],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":42,"column":10,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":42,"endColumn":13,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1400,1403],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1400,1403],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":51,"column":10,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":51,"endColumn":13,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1622,1625],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1622,1625],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":53,"column":76,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":53,"endColumn":79,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1705,1708],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1705,1708],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":55,"column":74,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":55,"endColumn":77,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1786,1789],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1786,1789],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":62,"column":10,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":62,"endColumn":13,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1983,1986],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1983,1986],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":6,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { TRANSLATIONS } from '../translations';\r\nimport { Asset, Category, Loan, Transaction } from '../types';\r\n\r\nimport { useAssets } from './useAssets';\r\nimport { useBudgetConversions } from './useBudgetConversions';\r\nimport { useBudgetData } from './useBudgetData';\r\nimport { useBudgetUsers } from './useBudgetUsers';\r\nimport { useCategories } from './useCategories';\r\nimport { useLoans } from './useLoans';\r\nimport { useTransactions } from './useTransactions';\r\n\r\n/**\r\n * useBudget Hook - Main orchestrator for budget data\r\n */\r\nexport const useBudget = (\r\n    activeBudgetId: string | null,\r\n    isPendingApproval: boolean,\r\n    user: any | null,\r\n    lang: string,\r\n    currency: string\r\n) => {\r\n    // @ts-expect-error - TRANSLATIONS is a JS object\r\n    const t = TRANSLATIONS[lang] || TRANSLATIONS['ua'];\r\n\r\n    // --- CORE BUDGET DATA ---\r\n    const { budgetData, loading, getBudgetDocRef } = useBudgetData(\r\n        activeBudgetId,\r\n        isPendingApproval,\r\n        user,\r\n        t\r\n    );\r\n\r\n    // --- CURRENCY CONVERSIONS ---\r\n    // @ts-expect-error - useBudgetConversions is JS hook without types\r\n    const { currentBalance, convertedLimits } = useBudgetConversions(budgetData, currency);\r\n\r\n    // --- USER MANAGEMENT ---\r\n    const { removeUser, leaveBudget, switchBudget } = useBudgetUsers(\r\n        activeBudgetId as string,\r\n        user,\r\n        getBudgetDocRef\r\n    ) as any;\r\n\r\n    // --- SUB-HOOKS FOR SPECIFIC DATA ---\r\n    const transactionLogic = useTransactions(\r\n        activeBudgetId as string,\r\n        user,\r\n        t,\r\n        currency,\r\n        budgetData.baseCurrency\r\n    ) as any;\r\n\r\n    const assetLogic = useAssets(activeBudgetId as string, currency, t) as any;\r\n\r\n    const loanLogic = useLoans(activeBudgetId as string, currency, t) as any;\r\n\r\n    const categoryLogic = useCategories(\r\n        activeBudgetId as string,\r\n        { categories: budgetData.categories, limits: convertedLimits },\r\n        t,\r\n        currency\r\n    ) as any;\r\n\r\n    // --- AGGREGATE RETURN ---\r\n    return {\r\n        // Core Data\r\n        loading: loading || transactionLogic.loadingTx,\r\n        currentBalance: currentBalance as number,\r\n        allowedUsers: budgetData.allowedUsers,\r\n        budgetOwnerId: budgetData.ownerId,\r\n\r\n        // Sub-hook Data\r\n        transactions: transactionLogic.transactions as Transaction[],\r\n        hasMore: transactionLogic.hasMore as boolean,\r\n        assets: assetLogic.assets as Asset[],\r\n        loans: loanLogic.loans as Loan[],\r\n        totalCreditDebt: loanLogic.totalCreditDebt as number,\r\n        allCategories: categoryLogic.allCategories as Category[],\r\n        categoryLimits: categoryLogic.categoryLimits as Record<string, number>,\r\n\r\n        // Actions\r\n        loadMore: transactionLogic.loadMore,\r\n\r\n        addAsset: assetLogic.addAsset,\r\n        updateAsset: assetLogic.updateAsset,\r\n        deleteAsset: assetLogic.deleteAsset,\r\n\r\n        addLoan: loanLogic.addLoan,\r\n        updateLoan: loanLogic.updateLoan,\r\n        deleteLoan: loanLogic.deleteLoan,\r\n\r\n        addCategory: categoryLogic.addCategory,\r\n        deleteCategory: categoryLogic.deleteCategory,\r\n        saveLimit: categoryLogic.saveLimit,\r\n\r\n        removeUser,\r\n        leaveBudget,\r\n        switchBudget,\r\n    };\r\n};\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\roman\\Projects\\smart-budget\\src\\hooks\\useBudgetConversions.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\roman\\Projects\\smart-budget\\src\\hooks\\useBudgetData.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":39,"column":8,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":39,"endColumn":11,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1069,1072],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1069,1072],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'icon' is defined but never used.","line":29,"column":23,"nodeType":"Identifier","messageId":"unusedVar","endLine":29,"endColumn":27,"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import {\r\n    doc,\r\n    onSnapshot,\r\n    setDoc,\r\n    updateDoc,\r\n    serverTimestamp,\r\n    DocumentReference,\r\n} from 'firebase/firestore';\r\nimport { useState, useEffect, useCallback } from 'react';\r\nimport { toast } from 'react-hot-toast';\r\n\r\nimport { DEFAULT_CATEGORIES } from '../constants';\r\nimport { db, appId } from '../firebase';\r\nimport { Category } from '../types';\r\n\r\nconst STORAGE_CURRENCY = 'EUR';\r\n\r\ninterface BudgetData {\r\n    currentBalance: number;\r\n    allowedUsers: string[];\r\n    ownerId: string | null;\r\n    categories: Category[];\r\n    limits: Record<string, number>;\r\n    baseCurrency: string;\r\n}\r\n\r\nconst cleanCategoriesForFirestore = (categories: Category[]): Omit<Category, 'icon'>[] =>\r\n    // eslint-disable-next-line @typescript-eslint/no-unused-vars\r\n    categories.map(({ icon, ...rest }) => rest);\r\n\r\n/**\r\n * useBudgetData Hook\r\n * Handles core Firestore subscription for budget document\r\n */\r\nexport const useBudgetData = (\r\n    activeBudgetId: string | null,\r\n    isPendingApproval: boolean,\r\n    user: { uid: string } | null,\r\n    t: any\r\n) => {\r\n    const [budgetData, setBudgetData] = useState<BudgetData>({\r\n        currentBalance: 0,\r\n        allowedUsers: [],\r\n        ownerId: null,\r\n        categories: [],\r\n        limits: {},\r\n        baseCurrency: 'UAH', // legacy fallback\r\n    });\r\n\r\n    const [loading, setLoading] = useState<boolean>(true);\r\n\r\n    const getBudgetDocRef = useCallback(\r\n        (): DocumentReference | null =>\r\n            activeBudgetId\r\n                ? doc(db, 'artifacts', appId, 'public', 'data', 'budgets', activeBudgetId)\r\n                : null,\r\n        [activeBudgetId]\r\n    );\r\n\r\n    // Core budget subscription\r\n    useEffect(() => {\r\n        if (!activeBudgetId || isPendingApproval) {\r\n            setLoading(false);\r\n            return;\r\n        }\r\n\r\n        const docRef = getBudgetDocRef();\r\n        if (!docRef) return;\r\n\r\n        const unsubscribe = onSnapshot(\r\n            docRef,\r\n            async (snap) => {\r\n                if (snap.exists()) {\r\n                    const data = snap.data();\r\n\r\n                    // Security check: verify user has access\r\n                    if (user && data.ownerId !== user.uid) {\r\n                        const isAuthorized = (data.authorizedUsers || []).includes(user.uid);\r\n                        if (!isAuthorized) {\r\n                            toast.error(t.access_lost || 'Access denied');\r\n                            // Redirect to user's own budget\r\n                            await updateDoc(\r\n                                doc(\r\n                                    db,\r\n                                    'artifacts',\r\n                                    appId,\r\n                                    'users',\r\n                                    user.uid,\r\n                                    'metadata',\r\n                                    'profile'\r\n                                ),\r\n                                { activeBudgetId: user.uid }\r\n                            );\r\n                            return;\r\n                        }\r\n                    }\r\n\r\n                    setBudgetData({\r\n                        currentBalance: data.currentBalance || 0,\r\n                        allowedUsers: data.authorizedUsers || [],\r\n                        ownerId: data.ownerId,\r\n                        categories: data.categories || [],\r\n                        limits: data.limits || {},\r\n                        baseCurrency: data.baseCurrency || 'UAH',\r\n                    });\r\n                } else {\r\n                    // Create budget document if it doesn't exist\r\n                    if (user && activeBudgetId === user.uid) {\r\n                        await setDoc(docRef, {\r\n                            createdAt: serverTimestamp(),\r\n                            ownerId: user.uid,\r\n                            categories: cleanCategoriesForFirestore(\r\n                                DEFAULT_CATEGORIES as unknown as Category[]\r\n                            ),\r\n                            limits: {},\r\n                            currentBalance: 0,\r\n                            storageCurrency: STORAGE_CURRENCY,\r\n                            baseCurrency: 'UAH',\r\n                        });\r\n                    }\r\n                }\r\n                setLoading(false);\r\n            },\r\n            (error) => {\r\n                console.error('Budget snapshot error:', error);\r\n                setLoading(false);\r\n            }\r\n        );\r\n\r\n        return () => unsubscribe();\r\n    }, [activeBudgetId, isPendingApproval, getBudgetDocRef, user, t]);\r\n\r\n    return {\r\n        budgetData,\r\n        loading,\r\n        getBudgetDocRef,\r\n    };\r\n};\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\roman\\Projects\\smart-budget\\src\\hooks\\useBudgetUsers.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\roman\\Projects\\smart-budget\\src\\hooks\\useCategories.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\roman\\Projects\\smart-budget\\src\\hooks\\useCurrencyRates.js","messages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'currencyCodes'. Either include it or remove the dependency array.","line":45,"column":8,"nodeType":"ArrayExpression","endLine":45,"endColumn":47,"suggestions":[{"desc":"Update the dependencies array to be: [baseCurrency, currencyCodes]","fix":{"range":[1431,1470],"text":"[baseCurrency, currencyCodes]"}}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a complex expression in the dependency array. Extract it to a separate variable so it can be statically checked.","line":45,"column":9,"nodeType":"CallExpression","endLine":45,"endColumn":32}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState, useEffect } from 'react';\r\n\r\nimport { fetchExchangeRateCached } from '../utils/currency';\r\n\r\nexport const useCurrencyRates = (currencyCodes, baseCurrency) => {\r\n    const [rates, setRates] = useState({});\r\n\r\n    useEffect(() => {\r\n        let isMounted = true;\r\n\r\n        const loadRates = async () => {\r\n            if (!baseCurrency) return;\r\n\r\n            // Filter unique codes needed\r\n            const uniqueCodes = [...new Set(currencyCodes)];\r\n            const newRates = {};\r\n            let hasUpdates = false;\r\n\r\n            await Promise.all(\r\n                uniqueCodes.map(async (code) => {\r\n                    if (code === baseCurrency) {\r\n                        newRates[code] = 1;\r\n                        return;\r\n                    }\r\n\r\n                    try {\r\n                        const rate = await fetchExchangeRateCached(code, baseCurrency);\r\n                        newRates[code] = rate;\r\n                        hasUpdates = true;\r\n                    } catch (e) {\r\n                        console.error(`Failed to fetch rate for ${code}`, e);\r\n                        newRates[code] = 1;\r\n                    }\r\n                })\r\n            );\r\n\r\n            if (isMounted && hasUpdates) {\r\n                setRates((prev) => ({ ...prev, ...newRates }));\r\n            }\r\n        };\r\n\r\n        if (currencyCodes.length > 0) {\r\n            loadRates();\r\n        }\r\n    }, [currencyCodes.join(','), baseCurrency]); // Dependency on stringified array to avoid loops\r\n\r\n    return rates;\r\n};\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\roman\\Projects\\smart-budget\\src\\hooks\\useFamilySync.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\roman\\Projects\\smart-budget\\src\\hooks\\useLoans.js","messages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'getLoansColRef'. Either include it or remove the dependency array.","line":30,"column":8,"nodeType":"ArrayExpression","endLine":30,"endColumn":24,"suggestions":[{"desc":"Update the dependencies array to be: [activeBudgetId, getLoansColRef]","fix":{"range":[957,973],"text":"[activeBudgetId, getLoansColRef]"}}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import {\r\n    collection,\r\n    onSnapshot,\r\n    addDoc,\r\n    updateDoc,\r\n    deleteDoc,\r\n    doc,\r\n    serverTimestamp,\r\n} from 'firebase/firestore';\r\nimport { useState, useEffect } from 'react';\r\nimport { toast } from 'react-hot-toast';\r\n\r\nimport { db, appId } from '../firebase';\r\nimport { fetchExchangeRate } from '../utils/currency';\r\n\r\nexport const useLoans = (activeBudgetId, currency, t) => {\r\n    const [loans, setLoans] = useState([]);\r\n    const [totalCreditDebt, setTotalCreditDebt] = useState(0);\r\n\r\n    const getLoansColRef = () =>\r\n        collection(db, 'artifacts', appId, 'public', 'data', 'budgets', activeBudgetId, 'loans');\r\n\r\n    useEffect(() => {\r\n        if (!activeBudgetId) return;\r\n        const unsubscribe = onSnapshot(getLoansColRef(), (snapshot) => {\r\n            const items = snapshot.docs.map((doc) => ({ id: doc.id, ...doc.data() }));\r\n            setLoans(items);\r\n        });\r\n        return () => unsubscribe();\r\n    }, [activeBudgetId]);\r\n\r\n    useEffect(() => {\r\n        let isMounted = true;\r\n        const calcDebt = async () => {\r\n            let total = 0;\r\n            for (const loan of loans) {\r\n                if (loan.currentBalance <= 0) continue;\r\n                let amount = parseFloat(loan.currentBalance || 0);\r\n                const loanCurr = loan.currency || 'UAH';\r\n\r\n                if (loanCurr === currency) {\r\n                    total += amount;\r\n                } else {\r\n                    try {\r\n                        const rate = await fetchExchangeRate(loanCurr, currency);\r\n                        total += amount * rate;\r\n                    } catch (e) {\r\n                        console.error('Rate fetch error in useLoans', e);\r\n                        // Fallback: add as is (better than 0, but inaccurate)\r\n                        total += amount;\r\n                    }\r\n                }\r\n            }\r\n            if (isMounted) setTotalCreditDebt(total);\r\n        };\r\n\r\n        calcDebt();\r\n        return () => {\r\n            isMounted = false;\r\n        };\r\n    }, [loans, currency]);\r\n\r\n    const addLoan = async (data) => {\r\n        if (!activeBudgetId) return;\r\n        await addDoc(getLoansColRef(), {\r\n            ...data,\r\n            createdAt: serverTimestamp(),\r\n        });\r\n    };\r\n\r\n    const updateLoan = async (id, data) => {\r\n        if (!activeBudgetId) return;\r\n        await updateDoc(doc(getLoansColRef(), id), data);\r\n    };\r\n\r\n    const deleteLoan = async (id) => {\r\n        if (!confirm(t.confirm_delete || 'Delete?')) return;\r\n        await deleteDoc(doc(getLoansColRef(), id));\r\n        toast.success(t.success_delete || 'Deleted');\r\n    };\r\n\r\n    return {\r\n        loans,\r\n        totalCreditDebt,\r\n        addLoan,\r\n        updateLoan,\r\n        deleteLoan,\r\n    };\r\n};\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\roman\\Projects\\smart-budget\\src\\hooks\\useTeamMembers.js","messages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'authorizedUsers'. Either include it or remove the dependency array.","line":95,"column":8,"nodeType":"ArrayExpression","endLine":95,"endColumn":65,"suggestions":[{"desc":"Update the dependencies array to be: [ownerId, currentUserId, authorizedUsers]","fix":{"range":[4109,4166],"text":"[ownerId, currentUserId, authorizedUsers]"}}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a complex expression in the dependency array. Extract it to a separate variable so it can be statically checked.","line":95,"column":9,"nodeType":"CallExpression","endLine":95,"endColumn":40}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { doc, onSnapshot } from 'firebase/firestore'; // Changed from getDoc to onSnapshot\r\nimport { useState, useEffect } from 'react';\r\n\r\nimport { db, appId } from '../firebase';\r\n\r\n/**\r\n * Hook to fetch and hydrate team member profiles from Firestore based on UIDs.\r\n * Switches to real-time listeners (onSnapshot) to reflect profile changes (like name edits) immediately.\r\n * * @param {string[]} authorizedUsers - Array of UIDs who have access.\r\n * @param {string} ownerId - The UID of the budget owner.\r\n * @param {string} currentUserId - The UID of the currently logged-in user.\r\n * @returns {Object} - Contains { members, loading }.\r\n */\r\nexport const useTeamMembers = (authorizedUsers = [], ownerId, currentUserId) => {\r\n    const [members, setMembers] = useState([]);\r\n    const [loading, setLoading] = useState(false);\r\n\r\n    useEffect(() => {\r\n        // If no owner, we can't really build the team list yet\r\n        if (!ownerId) {\r\n            setMembers([]);\r\n            return;\r\n        }\r\n\r\n        setLoading(true);\r\n\r\n        // 1. Combine owner and authorized users into a unique set to avoid duplicates\r\n        // JSON.stringify dependency check is not needed here as Set handles uniqueness,\r\n        // but react might re-run if array reference changes.\r\n        const allUids = Array.from(new Set([ownerId, ...(authorizedUsers || [])]));\r\n\r\n        // 2. Store unsubscribers for cleanup\r\n        const unsubscribes = [];\r\n\r\n        // 3. Local map to hold latest data for each user to prevent flickering/race conditions\r\n        // We initialize it empty, updates will fill it.\r\n        const currentDataMap = {};\r\n\r\n        // Helper function to rebuild the members array from the map\r\n        const updateMembersState = () => {\r\n            const validMembers = Object.values(currentDataMap).sort((a, b) => {\r\n                // Sorting logic: Owner -> Current User -> Others\r\n                if (a.isOwner) return -1;\r\n                if (b.isOwner) return 1;\r\n                if (a.isCurrentUser) return -1;\r\n                if (b.isCurrentUser) return 1;\r\n                return 0;\r\n            });\r\n            setMembers(validMembers);\r\n            setLoading(false);\r\n        };\r\n\r\n        // 4. Create a listener for EACH user in the list\r\n        allUids.forEach((uid) => {\r\n            try {\r\n                // Path consistent with useAuth.js: artifacts/{appId}/users/{uid}/metadata/profile\r\n                const userRef = doc(db, 'artifacts', appId, 'users', uid, 'metadata', 'profile');\r\n\r\n                const unsub = onSnapshot(\r\n                    userRef,\r\n                    (snapshot) => {\r\n                        const data = snapshot.exists() ? snapshot.data() : {};\r\n\r\n                        // Update the local map with the new real-time data\r\n                        currentDataMap[uid] = {\r\n                            uid,\r\n                            displayName: data.displayName || 'Unknown User',\r\n                            email: data.email || '',\r\n                            photoURL: data.photoURL || null,\r\n                            isOwner: uid === ownerId,\r\n                            isCurrentUser: uid === currentUserId,\r\n                            originalItem: uid, // Keep reference for removal logic\r\n                        };\r\n\r\n                        // Trigger state update immediately on any change\r\n                        updateMembersState();\r\n                    },\r\n                    (error) => {\r\n                        console.error(`Error listening to profile for ${uid}`, error);\r\n                    }\r\n                );\r\n\r\n                unsubscribes.push(unsub);\r\n            } catch (error) {\r\n                console.error(`Failed to setup listener for ${uid}`, error);\r\n            }\r\n        });\r\n\r\n        // 5. Cleanup function to unsubscribe all listeners when component unmounts or list changes\r\n        return () => {\r\n            unsubscribes.forEach((unsub) => unsub());\r\n        };\r\n\r\n        // We depend on the content of the authorizedUsers array, ownerId, or currentUserId changing\r\n    }, [JSON.stringify(authorizedUsers), ownerId, currentUserId]);\r\n\r\n    return { members, loading };\r\n};\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\roman\\Projects\\smart-budget\\src\\hooks\\useTransactionForm.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\roman\\Projects\\smart-budget\\src\\hooks\\useTransactionTotals.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\roman\\Projects\\smart-budget\\src\\hooks\\useTransactions.js","messages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'getTxColRef'. Either include it or remove the dependency array.","line":58,"column":8,"nodeType":"ArrayExpression","endLine":58,"endColumn":33,"suggestions":[{"desc":"Update the dependencies array to be: [activeBudgetId, getTxColRef, txLimit]","fix":{"range":[1767,1792],"text":"[activeBudgetId, getTxColRef, txLimit]"}}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { collection, query, orderBy, limit, onSnapshot } from 'firebase/firestore';\r\nimport { useState, useEffect, useMemo } from 'react';\r\n\r\nimport { db, appId } from '../firebase';\r\n\r\nimport { useCurrencyRates } from './useCurrencyRates';\r\n\r\nconst STORAGE_CURRENCY = 'EUR';\r\n\r\nexport const useTransactions = (\r\n    activeBudgetId,\r\n    user,\r\n    t,\r\n    mainCurrency = 'EUR',\r\n    legacyBaseCurrency = 'UAH'\r\n) => {\r\n    const [rawTransactions, setRawTransactions] = useState([]);\r\n    const [hasMore, setHasMore] = useState(true);\r\n    const [loadingTx, setLoadingTx] = useState(false);\r\n    const [txLimit, setTxLimit] = useState(50);\r\n\r\n    // Helper for paths\r\n    const getTxColRef = () =>\r\n        collection(db, 'artifacts', appId, 'users', activeBudgetId, 'transactions');\r\n\r\n    // 1. Real-time Transaction Listener\r\n    useEffect(() => {\r\n        if (!activeBudgetId) {\r\n            setRawTransactions([]);\r\n            return;\r\n        }\r\n\r\n        setLoadingTx(true);\r\n\r\n        const q = query(\r\n            getTxColRef(),\r\n            orderBy('date', 'desc'),\r\n            orderBy('createdAt', 'desc'),\r\n            limit(txLimit)\r\n        );\r\n\r\n        const unsubscribe = onSnapshot(\r\n            q,\r\n            (snapshot) => {\r\n                const txs = snapshot.docs.map((doc) => ({ id: doc.id, ...doc.data() }));\r\n                setRawTransactions(txs);\r\n                setHasMore(snapshot.docs.length === txLimit);\r\n                setLoadingTx(false);\r\n            },\r\n            (error) => {\r\n                console.error('Error fetching transactions:', error);\r\n                setLoadingTx(false);\r\n            }\r\n        );\r\n\r\n        // Cleanup listener on unmount or dependency change\r\n        return () => unsubscribe();\r\n    }, [activeBudgetId, txLimit]);\r\n\r\n    // 2. Identify Currencies needed for View\r\n    const currenciesNeeded = useMemo(() => {\r\n        const set = new Set();\r\n        set.add(legacyBaseCurrency);\r\n        rawTransactions.forEach((t) => {\r\n            if (t.originalCurrency) set.add(t.originalCurrency);\r\n        });\r\n        return Array.from(set);\r\n    }, [rawTransactions, legacyBaseCurrency]);\r\n\r\n    // 3. Fetch Rates Efficiently (Cached)\r\n    const rates = useCurrencyRates(currenciesNeeded, mainCurrency);\r\n\r\n    // 4. Memoized Display Conversion\r\n    const transactions = useMemo(() => {\r\n        return rawTransactions.map((t) => {\r\n            const sourceCurr = t.originalCurrency || legacyBaseCurrency;\r\n            const sourceAmt = t.originalAmount !== undefined ? t.originalAmount : t.amount;\r\n            const rate = rates[sourceCurr] || 1;\r\n\r\n            // Round to 2 decimal places to avoid floating point issues\r\n            const convertedAmount = Math.round(Math.abs(sourceAmt) * rate * 100) / 100;\r\n            return { ...t, amount: convertedAmount };\r\n        });\r\n    }, [rawTransactions, rates, legacyBaseCurrency]);\r\n\r\n    const loadMore = () => {\r\n        setTxLimit((prev) => prev + 50);\r\n    };\r\n\r\n    // NOTE: This hook is READ-ONLY. It provides real-time transaction data via onSnapshot.\r\n    // All WRITE operations (add/update/delete) are handled by useBudgetStore -> transactionsService.\r\n    // The listener automatically updates UI when Firestore changes.\r\n\r\n    return {\r\n        transactions, // Converted for display\r\n        loadMore,\r\n        hasMore,\r\n        loadingTx, // Loading state\r\n    };\r\n};\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\roman\\Projects\\smart-budget\\src\\locales\\en.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\roman\\Projects\\smart-budget\\src\\locales\\pl.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\roman\\Projects\\smart-budget\\src\\locales\\ua.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\roman\\Projects\\smart-budget\\src\\main.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\roman\\Projects\\smart-budget\\src\\providers\\AppProviders.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\roman\\Projects\\smart-budget\\src\\routes\\AppRoutes.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\roman\\Projects\\smart-budget\\src\\services\\assets.service.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\roman\\Projects\\smart-budget\\src\\services\\budget.service.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\roman\\Projects\\smart-budget\\src\\services\\categories.service.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\roman\\Projects\\smart-budget\\src\\services\\categoryRules.service.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\roman\\Projects\\smart-budget\\src\\services\\geminiCategorizer.service.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\roman\\Projects\\smart-budget\\src\\services\\loans.service.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\roman\\Projects\\smart-budget\\src\\services\\monobank-integration.service.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\roman\\Projects\\smart-budget\\src\\services\\monobank.service.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\roman\\Projects\\smart-budget\\src\\services\\transactions.service.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":77,"column":29,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":77,"endColumn":32,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2234,2237],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2234,2237],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":134,"column":33,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":134,"endColumn":36,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4392,4395],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4392,4395],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import {\r\n    collection,\r\n    doc,\r\n    writeBatch,\r\n    serverTimestamp,\r\n    increment,\r\n    runTransaction,\r\n    query,\r\n    where,\r\n    getDocs,\r\n    updateDoc,\r\n    DocumentReference,\r\n    CollectionReference,\r\n} from 'firebase/firestore';\r\n\r\nimport { db, appId } from '../firebase';\r\nimport { Transaction } from '../types';\r\nimport { fetchExchangeRate } from '../utils/currency';\r\n\r\nexport interface TransactionData extends Omit<Transaction, 'id' | 'userId' | 'date'> {\r\n    date: Date;\r\n    originalAmount: number;\r\n    originalCurrency?: string;\r\n    importId?: string;\r\n    importSource?: string;\r\n    comment?: string;\r\n    category?: string;\r\n}\r\n\r\n/**\r\n * TransactionService\r\n * Handles all direct interactions with Firestore regarding transactions.\r\n * Decoupled from React state and hooks.\r\n */\r\nclass TransactionService {\r\n    private storageCurrency: string;\r\n\r\n    constructor() {\r\n        this.storageCurrency = 'EUR';\r\n    }\r\n\r\n    /**\r\n     * Helper to get transaction collection reference\r\n     */\r\n    private getTxColRef(budgetId: string): CollectionReference {\r\n        return collection(db, 'artifacts', appId, 'users', budgetId, 'transactions');\r\n    }\r\n\r\n    /**\r\n     * Helper to get budget document reference\r\n     */\r\n    private getBudgetDocRef(budgetId: string): DocumentReference {\r\n        return doc(db, 'artifacts', appId, 'public', 'data', 'budgets', budgetId);\r\n    }\r\n\r\n    /**\r\n     * Add a new transaction\r\n     */\r\n    async addTransaction(\r\n        budgetId: string,\r\n        user: { uid: string; displayName: string | null; email: string | null },\r\n        data: TransactionData,\r\n        mainCurrency: string = 'EUR'\r\n    ) {\r\n        if (!budgetId || !user) throw new Error('Missing budgetId or user');\r\n\r\n        const batch = writeBatch(db);\r\n        const newTxRef = doc(this.getTxColRef(budgetId));\r\n\r\n        const inputCurrency = data.originalCurrency || mainCurrency;\r\n        let rateToStorage = 1;\r\n\r\n        // Calculate rate if input currency differs from storage currency (EUR)\r\n        if (inputCurrency !== this.storageCurrency) {\r\n            try {\r\n                rateToStorage = await fetchExchangeRate(inputCurrency, this.storageCurrency);\r\n            } catch (error: any) {\r\n                console.error('Failed to fetch rate:', error);\r\n                throw new Error(`Currency conversion failed: ${error.message}`);\r\n            }\r\n        }\r\n\r\n        const absOriginal = Math.abs(data.originalAmount);\r\n        const amountInStorage = absOriginal * rateToStorage;\r\n\r\n        const payload = {\r\n            ...data,\r\n            originalAmount: absOriginal,\r\n            amount: amountInStorage,\r\n            userId: user.uid,\r\n            userName: user.displayName || user.email?.split('@')[0] || 'Unknown',\r\n            updatedAt: serverTimestamp(),\r\n            createdAt: serverTimestamp(),\r\n        };\r\n\r\n        batch.set(newTxRef, payload);\r\n\r\n        // Update budget balance\r\n        const adjustment = payload.type === 'income' ? amountInStorage : -amountInStorage;\r\n        batch.update(this.getBudgetDocRef(budgetId), { currentBalance: increment(adjustment) });\r\n\r\n        await batch.commit();\r\n        return { id: newTxRef.id, ...payload };\r\n    }\r\n\r\n    /**\r\n     * Update an existing transaction\r\n     */\r\n    async updateTransaction(\r\n        budgetId: string,\r\n        id: string,\r\n        newData: TransactionData,\r\n        mainCurrency: string = 'EUR'\r\n    ) {\r\n        if (!budgetId) throw new Error('Missing budgetId');\r\n\r\n        const txRef = doc(this.getTxColRef(budgetId), id);\r\n        const budgetRef = this.getBudgetDocRef(budgetId);\r\n\r\n        await runTransaction(db, async (transaction) => {\r\n            const txDoc = await transaction.get(txRef);\r\n            if (!txDoc.exists()) throw new Error('Transaction does not exist!');\r\n\r\n            const oldData = txDoc.data();\r\n            const oldStorageAmount = Math.abs(parseFloat(oldData.amount));\r\n            const oldImpact = oldData.type === 'income' ? oldStorageAmount : -oldStorageAmount;\r\n\r\n            const inputCurrency = newData.originalCurrency || mainCurrency;\r\n            let newRateToStorage = 1;\r\n\r\n            if (inputCurrency !== this.storageCurrency) {\r\n                try {\r\n                    newRateToStorage = await fetchExchangeRate(inputCurrency, this.storageCurrency);\r\n                } catch (error: any) {\r\n                    console.error('Failed to fetch rate:', error);\r\n                    throw new Error(`Currency conversion failed: ${error.message}`);\r\n                }\r\n            }\r\n\r\n            const absNewOriginal = Math.abs(newData.originalAmount);\r\n            const newStorageAmount = absNewOriginal * newRateToStorage;\r\n            const newImpact = newData.type === 'income' ? newStorageAmount : -newStorageAmount;\r\n\r\n            const diff = newImpact - oldImpact;\r\n\r\n            transaction.update(txRef, {\r\n                ...newData,\r\n                originalAmount: absNewOriginal,\r\n                amount: newStorageAmount,\r\n                updatedAt: serverTimestamp(),\r\n            });\r\n\r\n            // Optimize write: only update balance if significant change\r\n            if (Math.abs(diff) > 0.0001) {\r\n                transaction.update(budgetRef, { currentBalance: increment(diff) });\r\n            }\r\n        });\r\n    }\r\n\r\n    /**\r\n     * Delete a transaction\r\n     */\r\n    async deleteTransaction(budgetId: string, id: string) {\r\n        if (!budgetId) throw new Error('Missing budgetId');\r\n\r\n        const txRef = doc(this.getTxColRef(budgetId), id);\r\n        const budgetRef = this.getBudgetDocRef(budgetId);\r\n\r\n        await runTransaction(db, async (transaction) => {\r\n            const txDoc = await transaction.get(txRef);\r\n            if (!txDoc.exists()) throw new Error('Transaction not found');\r\n\r\n            const oldData = txDoc.data();\r\n            const oldStorageAmount = Math.abs(parseFloat(oldData.amount));\r\n            const adjustment = oldData.type === 'income' ? -oldStorageAmount : oldStorageAmount;\r\n\r\n            transaction.delete(txRef);\r\n            transaction.update(budgetRef, { currentBalance: increment(adjustment) });\r\n        });\r\n    }\r\n\r\n    /**\r\n     * Import multiple transactions from CSV\r\n     */\r\n    async importTransactions(\r\n        budgetId: string,\r\n        user: { uid: string; displayName: string | null; email: string | null },\r\n        transactions: TransactionData[],\r\n        mainCurrency: string = 'EUR'\r\n    ) {\r\n        if (!budgetId || !user) throw new Error('Missing budgetId or user');\r\n        if (!transactions || transactions.length === 0) {\r\n            return { imported: 0, skipped: 0 };\r\n        }\r\n\r\n        const txColRef = this.getTxColRef(budgetId);\r\n        const budgetRef = this.getBudgetDocRef(budgetId);\r\n\r\n        // Extract all importIds from incoming transactions\r\n        const incomingImportIds = transactions\r\n            .filter((tx) => tx.importId)\r\n            .map((tx) => tx.importId as string);\r\n\r\n        // Query existing transactions with these importIds to detect duplicates\r\n        const existingImportIds = new Set<string>();\r\n\r\n        if (incomingImportIds.length > 0) {\r\n            // Chunk into groups of 30 for Firestore 'in' query limit\r\n            const chunks: string[][] = [];\r\n            for (let i = 0; i < incomingImportIds.length; i += 30) {\r\n                chunks.push(incomingImportIds.slice(i, i + 30));\r\n            }\r\n\r\n            for (const chunk of chunks) {\r\n                const q = query(txColRef, where('importId', 'in', chunk));\r\n                const snapshot = await getDocs(q);\r\n                snapshot.forEach((doc) => {\r\n                    const data = doc.data();\r\n                    if (data.importId) {\r\n                        existingImportIds.add(data.importId);\r\n                    }\r\n                });\r\n            }\r\n        }\r\n\r\n        // Filter out duplicates\r\n        const newTransactions = transactions.filter(\r\n            (tx) => !tx.importId || !existingImportIds.has(tx.importId)\r\n        );\r\n\r\n        if (newTransactions.length === 0) {\r\n            return { imported: 0, skipped: transactions.length };\r\n        }\r\n\r\n        // Batch write in groups of 500 (Firestore limit)\r\n        let totalBalanceChange = 0;\r\n        const batchSize = 450; // Leave room for balance update\r\n\r\n        for (let i = 0; i < newTransactions.length; i += batchSize) {\r\n            const batch = writeBatch(db);\r\n            const batchTransactions = newTransactions.slice(i, i + batchSize);\r\n\r\n            for (const txData of batchTransactions) {\r\n                const newTxRef = doc(txColRef);\r\n\r\n                // Convert currency if needed\r\n                const inputCurrency = txData.originalCurrency || mainCurrency;\r\n                let rateToStorage = 1;\r\n\r\n                if (inputCurrency !== this.storageCurrency) {\r\n                    try {\r\n                        rateToStorage = await fetchExchangeRate(\r\n                            inputCurrency,\r\n                            this.storageCurrency\r\n                        );\r\n                    } catch (error) {\r\n                        console.warn(`[Import] Failed to fetch rate for ${inputCurrency}:`, error);\r\n                        // Use 1:1 as fallback\r\n                        rateToStorage = 1;\r\n                    }\r\n                }\r\n\r\n                const absOriginal = Math.abs(txData.originalAmount);\r\n                const amountInStorage = absOriginal * rateToStorage;\r\n\r\n                const payload = {\r\n                    date: txData.date,\r\n                    originalAmount: absOriginal,\r\n                    originalCurrency: inputCurrency,\r\n                    amount: amountInStorage,\r\n                    type: txData.type,\r\n                    category: txData.category || 'other',\r\n                    comment: txData.comment || '',\r\n                    importId: txData.importId,\r\n                    importSource: 'revolut',\r\n                    userId: user.uid,\r\n                    userName: user.displayName || user.email?.split('@')[0] || 'Unknown',\r\n                    updatedAt: serverTimestamp(),\r\n                    createdAt: serverTimestamp(),\r\n                };\r\n\r\n                batch.set(newTxRef, payload);\r\n\r\n                // Calculate balance impact\r\n                const impact = payload.type === 'income' ? amountInStorage : -amountInStorage;\r\n                totalBalanceChange += impact;\r\n            }\r\n\r\n            await batch.commit();\r\n        }\r\n\r\n        // Update budget balance\r\n        if (Math.abs(totalBalanceChange) > 0.0001) {\r\n            await updateDoc(budgetRef, { currentBalance: increment(totalBalanceChange) });\r\n        }\r\n\r\n        return {\r\n            imported: newTransactions.length,\r\n            skipped: transactions.length - newTransactions.length,\r\n        };\r\n    }\r\n}\r\n\r\nexport const transactionsService = new TransactionService();\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\roman\\Projects\\smart-budget\\src\\setupTests.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\roman\\Projects\\smart-budget\\src\\store\\useBudgetStore.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":22,"column":15,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":22,"endColumn":18,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[829,832],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[829,832],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":25,"column":13,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":25,"endColumn":16,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[910,913],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[910,913],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":32,"column":13,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":32,"endColumn":16,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1089,1092],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1089,1092],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":34,"column":59,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":34,"endColumn":62,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1177,1180],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1177,1180],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":37,"column":74,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":37,"endColumn":77,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1291,1294],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1291,1294],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":43,"column":13,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":43,"endColumn":16,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1458,1461],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1458,1461],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":45,"column":53,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":45,"endColumn":56,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1540,1543],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1540,1543],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":48,"column":39,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":48,"endColumn":42,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1672,1675],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1672,1675],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":48,"column":48,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":48,"endColumn":51,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1681,1684],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1681,1684],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":49,"column":54,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":49,"endColumn":57,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1758,1761],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1758,1761],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":49,"column":63,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":49,"endColumn":66,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1767,1770],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1767,1770],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":50,"column":52,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":50,"endColumn":55,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1842,1845],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1842,1845],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":51,"column":39,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":51,"endColumn":42,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1904,1907],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1904,1907],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":51,"column":64,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":51,"endColumn":67,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1929,1932],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1929,1932],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":54,"column":43,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":54,"endColumn":46,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2027,2030],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2027,2030],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":54,"column":52,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":54,"endColumn":55,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2036,2039],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2036,2039],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":55,"column":64,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":55,"endColumn":67,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2123,2126],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2123,2126],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":60,"column":13,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":60,"endColumn":16,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2266,2269],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2266,2269],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":62,"column":66,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":62,"endColumn":69,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2361,2364],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2361,2364],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":63,"column":57,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":63,"endColumn":60,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2441,2444],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2441,2444],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":85,"column":25,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":85,"endColumn":28,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3197,3200],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3197,3200],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":100,"column":25,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":100,"endColumn":28,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3793,3796],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3793,3796],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":22,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { toast } from 'react-hot-toast';\r\nimport { create } from 'zustand';\r\n\r\n// Services\r\nimport { assetsService, AssetData } from '../services/assets.service';\r\n// These services are still JS, so they will be treated as any (or implicit types if allowJs allows inference)\r\nimport { budgetService } from '../services/budget.service';\r\nimport { categoriesService } from '../services/categories.service';\r\nimport { loansService } from '../services/loans.service';\r\nimport { transactionsService, TransactionData } from '../services/transactions.service';\r\n\r\ninterface BudgetStoreState {\r\n    isTransactionLoading: boolean;\r\n    isAssetLoading: boolean;\r\n    isLoanLoading: boolean;\r\n    isSettingsLoading: boolean;\r\n    error: string | null;\r\n\r\n    // Transactions\r\n    addTransaction: (\r\n        budgetId: string,\r\n        user: any,\r\n        data: TransactionData,\r\n        mainCurrency: string,\r\n        t?: any\r\n    ) => Promise<void>;\r\n    updateTransaction: (\r\n        budgetId: string,\r\n        id: string,\r\n        data: TransactionData,\r\n        mainCurrency: string,\r\n        t?: any\r\n    ) => Promise<void>;\r\n    deleteTransaction: (budgetId: string, id: string, t?: any) => Promise<void>;\r\n\r\n    // Assets\r\n    addAsset: (budgetId: string, data: AssetData, currency?: string, t?: any) => Promise<void>;\r\n    updateAsset: (\r\n        budgetId: string,\r\n        id: string,\r\n        data: Partial<AssetData>,\r\n        currency?: string,\r\n        t?: any\r\n    ) => Promise<void>;\r\n    deleteAsset: (budgetId: string, id: string, t?: any) => Promise<void>;\r\n\r\n    // Loans (Using 'any' for data until loansService is migrated)\r\n    addLoan: (budgetId: string, data: any, t?: any) => Promise<void>;\r\n    updateLoan: (budgetId: string, id: string, data: any, t?: any) => Promise<void>;\r\n    deleteLoan: (budgetId: string, id: string, t?: any) => Promise<void>;\r\n    payLoan: (budgetId: string, loan: any, amount: string, t?: any) => Promise<void>;\r\n\r\n    // Categories & Settings\r\n    addCategory: (budgetId: string, data: any, t?: any) => Promise<void>;\r\n    deleteCategory: (budgetId: string, categoryId: string, t?: any) => Promise<void>;\r\n    saveCategoryLimit: (\r\n        budgetId: string,\r\n        categoryId: string,\r\n        amount: number,\r\n        t?: any\r\n    ) => Promise<void>;\r\n    removeUserFromBudget: (budgetId: string, userId: string, t?: any) => Promise<void>;\r\n    leaveBudget: (budgetId: string, userId: string, t?: any) => Promise<void>;\r\n}\r\n\r\n/**\r\n * useBudgetStore\r\n * Global state management for budget data.\r\n * Centralizes all WRITE operations via Service Layer.\r\n */\r\nexport const useBudgetStore = create<BudgetStoreState>((set) => ({\r\n    // --- STATE ---\r\n    isTransactionLoading: false,\r\n    isAssetLoading: false,\r\n    isLoanLoading: false,\r\n    isSettingsLoading: false,\r\n    error: null,\r\n\r\n    // --- TRANSACTIONS ACTIONS ---\r\n    addTransaction: async (budgetId, user, data, mainCurrency, t) => {\r\n        set({ isTransactionLoading: true, error: null });\r\n        try {\r\n            await transactionsService.addTransaction(budgetId, user, data, mainCurrency);\r\n            toast.success(t?.success_save || 'Saved successfully');\r\n        } catch (error: any) {\r\n            console.error(error);\r\n            set({ error: error.message });\r\n            toast.error(t?.error_save || 'Error saving transaction');\r\n            throw error;\r\n        } finally {\r\n            set({ isTransactionLoading: false });\r\n        }\r\n    },\r\n\r\n    updateTransaction: async (budgetId, id, data, mainCurrency, t) => {\r\n        set({ isTransactionLoading: true });\r\n        try {\r\n            await transactionsService.updateTransaction(budgetId, id, data, mainCurrency);\r\n            toast.success(t?.success_save || 'Saved successfully');\r\n        } catch (error: any) {\r\n            set({ error: error.message });\r\n            toast.error(t?.error_save || 'Error updating');\r\n            throw error;\r\n        } finally {\r\n            set({ isTransactionLoading: false });\r\n        }\r\n    },\r\n\r\n    deleteTransaction: async (budgetId, id, t) => {\r\n        try {\r\n            await transactionsService.deleteTransaction(budgetId, id);\r\n            toast.success(t?.success_delete || 'Deleted successfully');\r\n        } catch (error) {\r\n            console.error(error);\r\n            toast.error('Error deleting transaction');\r\n        }\r\n    },\r\n\r\n    // --- ASSETS ACTIONS ---\r\n    addAsset: async (budgetId, data, currency, t) => {\r\n        set({ isAssetLoading: true });\r\n        try {\r\n            const payload = { ...data, currency: data.currency || currency! };\r\n            await assetsService.addAsset(budgetId, payload);\r\n            toast.success(t?.success_save || 'Asset saved');\r\n        } catch (error) {\r\n            console.error(error);\r\n            toast.error(t?.error_save || 'Error saving asset');\r\n            throw error;\r\n        } finally {\r\n            set({ isAssetLoading: false });\r\n        }\r\n    },\r\n\r\n    updateAsset: async (budgetId, id, data, currency, t) => {\r\n        set({ isAssetLoading: true });\r\n        try {\r\n            const payload = { ...data, currency: data.currency || currency };\r\n            await assetsService.updateAsset(budgetId, id, payload);\r\n            toast.success(t?.success_save || 'Asset updated');\r\n        } catch (error) {\r\n            console.error(error);\r\n            toast.error(t?.error_save || 'Error updating asset');\r\n            throw error;\r\n        } finally {\r\n            set({ isAssetLoading: false });\r\n        }\r\n    },\r\n\r\n    deleteAsset: async (budgetId, id, t) => {\r\n        try {\r\n            await assetsService.deleteAsset(budgetId, id);\r\n            toast.success(t?.success_delete || 'Asset deleted');\r\n        } catch (error) {\r\n            console.error(error);\r\n            toast.error('Error deleting asset');\r\n        }\r\n    },\r\n\r\n    // --- LOANS ACTIONS ---\r\n    addLoan: async (budgetId, data, t) => {\r\n        set({ isLoanLoading: true });\r\n        try {\r\n            await loansService.addLoan(budgetId, data);\r\n            toast.success(t?.success_save || 'Loan saved');\r\n        } catch (error) {\r\n            console.error(error);\r\n            toast.error(t?.error_save || 'Error saving loan');\r\n            throw error;\r\n        } finally {\r\n            set({ isLoanLoading: false });\r\n        }\r\n    },\r\n\r\n    updateLoan: async (budgetId, id, data, t) => {\r\n        set({ isLoanLoading: true });\r\n        try {\r\n            await loansService.updateLoan(budgetId, id, data);\r\n            toast.success(t?.success_save || 'Loan updated');\r\n        } catch (error) {\r\n            console.error(error);\r\n            toast.error(t?.error_save || 'Error updating loan');\r\n            throw error;\r\n        } finally {\r\n            set({ isLoanLoading: false });\r\n        }\r\n    },\r\n\r\n    deleteLoan: async (budgetId, id, t) => {\r\n        try {\r\n            await loansService.deleteLoan(budgetId, id);\r\n            toast.success(t?.success_delete || 'Loan deleted');\r\n        } catch (error) {\r\n            console.error(error);\r\n            toast.error('Error deleting loan');\r\n        }\r\n    },\r\n\r\n    payLoan: async (budgetId, loan, amount, t) => {\r\n        set({ isLoanLoading: true });\r\n        try {\r\n            const numAmount = parseFloat(amount);\r\n            if (numAmount <= 0) return;\r\n            const newBalance = loan.currentBalance - numAmount;\r\n            await loansService.updateLoan(budgetId, loan.id, { currentBalance: newBalance });\r\n            toast.success(t?.payment_recorded || 'Payment recorded');\r\n        } catch (error) {\r\n            console.error(error);\r\n            toast.error('Payment failed');\r\n            throw error;\r\n        } finally {\r\n            set({ isLoanLoading: false });\r\n        }\r\n    },\r\n\r\n    // --- CATEGORIES & SETTINGS ACTIONS ---\r\n\r\n    addCategory: async (budgetId, data, t) => {\r\n        set({ isSettingsLoading: true });\r\n        try {\r\n            await categoriesService.addCategory(budgetId, data);\r\n            toast.success(t?.success_save || 'Category added');\r\n        } catch (error) {\r\n            console.error(error);\r\n            toast.error(t?.error_save || 'Error adding category');\r\n            throw error;\r\n        } finally {\r\n            set({ isSettingsLoading: false });\r\n        }\r\n    },\r\n\r\n    deleteCategory: async (budgetId, categoryId, t) => {\r\n        set({ isSettingsLoading: true });\r\n        try {\r\n            await categoriesService.deleteCategory(budgetId, categoryId);\r\n            toast.success(t?.success_delete || 'Category deleted');\r\n        } catch (error) {\r\n            console.error(error);\r\n            toast.error('Error deleting category');\r\n        } finally {\r\n            set({ isSettingsLoading: false });\r\n        }\r\n    },\r\n\r\n    saveCategoryLimit: async (budgetId, categoryId, amount, t) => {\r\n        set({ isSettingsLoading: true });\r\n        try {\r\n            await categoriesService.saveLimit(budgetId, categoryId, amount);\r\n            toast.success(t?.success_save || 'Limit saved');\r\n        } catch (error) {\r\n            console.error(error);\r\n            toast.error(t?.error_save || 'Error saving limit');\r\n        } finally {\r\n            set({ isSettingsLoading: false });\r\n        }\r\n    },\r\n\r\n    removeUserFromBudget: async (budgetId, userId) => {\r\n        set({ isSettingsLoading: true });\r\n        try {\r\n            await budgetService.removeUser(budgetId, userId);\r\n            toast.success('User removed');\r\n        } catch (error) {\r\n            console.error(error);\r\n            toast.error('Error removing user');\r\n        } finally {\r\n            set({ isSettingsLoading: false });\r\n        }\r\n    },\r\n\r\n    leaveBudget: async (budgetId, userId) => {\r\n        set({ isSettingsLoading: true });\r\n        try {\r\n            await budgetService.leaveBudget(budgetId, userId);\r\n            toast.success('Left budget');\r\n        } catch (error) {\r\n            console.error(error);\r\n            toast.error('Error leaving budget');\r\n        } finally {\r\n            set({ isSettingsLoading: false });\r\n        }\r\n    },\r\n}));\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\roman\\Projects\\smart-budget\\src\\store\\useModalStore.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\roman\\Projects\\smart-budget\\src\\store\\useMonobankStore.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\roman\\Projects\\smart-budget\\src\\translations.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\roman\\Projects\\smart-budget\\src\\types\\index.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":13,"column":12,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":13,"endColumn":15,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[283,286],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[283,286],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"export interface UserProfile {\r\n    uid: string;\r\n    email: string | null;\r\n    displayName: string | null;\r\n    photoURL: string | null;\r\n    emailVerified: boolean;\r\n}\r\n\r\nexport interface Category {\r\n    id: string;\r\n    name: string;\r\n    type: 'income' | 'expense';\r\n    icon?: any;\r\n    color?: string; // Optional presentation properties\r\n    textColor?: string;\r\n    iconId?: string;\r\n}\r\n\r\nexport interface Budget {\r\n    id: string;\r\n    ownerId: string;\r\n    name: string;\r\n    currency: string;\r\n    members: string[];\r\n    allowedUsers?: string[];\r\n    isShared?: boolean;\r\n}\r\n\r\nexport interface Transaction {\r\n    id: string;\r\n    amount: number;\r\n    categoryId: string;\r\n    date: Date;\r\n    description: string;\r\n    type: 'income' | 'expense';\r\n    userId: string;\r\n    currency: string;\r\n    originalAmount?: number;\r\n    originalCurrency?: string;\r\n    isTransfer?: boolean;\r\n    toAccountId?: string;\r\n}\r\n\r\nexport interface Asset {\r\n    id: string;\r\n    name: string;\r\n    value: number;\r\n    currency: string;\r\n    type: string;\r\n}\r\n\r\nexport interface Loan {\r\n    id: string;\r\n    name: string;\r\n    amount: number;\r\n    currency: string;\r\n    type: 'debt' | 'credit';\r\n    interestRate?: number;\r\n    paidAmount: number;\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\roman\\Projects\\smart-budget\\src\\utils\\colors.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\roman\\Projects\\smart-budget\\src\\utils\\currency.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\roman\\Projects\\smart-budget\\src\\utils\\mccCodes.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\roman\\Projects\\smart-budget\\src\\utils\\revolutParser.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]}]
